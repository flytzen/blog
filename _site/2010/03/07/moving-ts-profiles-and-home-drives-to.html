<!DOCTYPE html>
<html lang="en">

  <head>
  <title>Frans' Randomness - Moving TS Profiles and Home Drives to another server</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="format-detection" content="telephone=no" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Frans' Randomness" />
  
  <meta name="description" content="I recently found myself in the situation of having to move the Terminal Server user profiles and the Home Drives directory from one server to another. There are similar challenges involved to moving Roaming Profiles, because you do not have access rights to the user’s profile directory, so you can’t..." />
</head>


  <body>

    <header class="header" role="banner">
  <div class="wrapper">
    
    
    <a class="header__title h3" rel="author" href="/">Frans&#39; Randomness</a>
    
      <nav class="header__nav">
          <a class="header__nav-link" href="/talks">Talks</a>
          <a class="header__nav-link" href="/blog">Blog</a>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post__header">
    <div class="wrapper">
      <h1 class="post__title" itemprop="name headline">Moving TS Profiles and Home Drives to another server</h1>
      
      <div class="post__meta">
        <div class="post__author-time">
          
          <span class="post__author" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span itemprop="name">Author <strong>Frans Lytzen</strong></span>
          </span>
          
          
          <time class="post__date-time dt-published" datetime="2010-03-07T21:45:00+00:00" itemprop="datePublished">
            <div class="date-time icon__item">
              <svg class="icon__gfx" style="width:24px;height:24px" viewBox="0 0 24 24">
                <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1" />
              </svg>
              <span class="icon__txt">07 Mar 2010</span>
            </div>
          </time>
          
        </div>
        
        <div class="tags icon__item">
          <svg class="icon__gfx" style="width:24px;height:24px" viewBox="0 0 24 24">
              <path d="M5.5,9A1.5,1.5 0 0,0 7,7.5A1.5,1.5 0 0,0 5.5,6A1.5,1.5 0 0,0 4,7.5A1.5,1.5 0 0,0 5.5,9M17.41,11.58C17.77,11.94 18,12.44 18,13C18,13.55 17.78,14.05 17.41,14.41L12.41,19.41C12.05,19.77 11.55,20 11,20C10.45,20 9.95,19.78 9.58,19.41L2.59,12.42C2.22,12.05 2,11.55 2,11V6C2,4.89 2.89,4 4,4H9C9.55,4 10.05,4.22 10.41,4.58L17.41,11.58M13.54,5.71L14.54,4.71L21.41,11.58C21.78,11.94 22,12.45 22,13C22,13.55 21.78,14.05 21.42,14.41L16.04,19.79L15.04,18.79L20.75,13L13.54,5.71Z" />
          </svg>
          
            <a href="/tags/#Technology" class="icon__txt tag">Technology</a>
          
        </div>
        
      </div>
      
    </div>
  </header>

  <div class="wrapper">

    <div class="post__content e-content" itemprop="articleBody">
      <p>I recently found myself in the situation of having to move the Terminal Server user profiles and the Home Drives directory from one server to another. There are similar challenges involved to moving Roaming Profiles, because you do not have access rights to the user’s profile directory, so you can’t just copy the data.</p>  <p>In short, you need to use </p>  <blockquote>   <p>robocopy /e /b /copyall </p> </blockquote>  <p>to copy the folder from one server to another.    <br />After the files are copied, you should be able to just update the Terminal Server Group Policy with the new locations.</p>  <p>But, let me take you through the hoops I had to go through, just in case you have some of the same issues.</p>  <p>The TSProfiles and HomeDrives resided on a Windows Server 2008 server (AD1) and I wanted to move them to a Windows Server 2003 Server (FS1). </p>  <p>Robocopy is included in Windows Server 2008 so I decided to try to do the copy from the 2008 server like this;</p>  <blockquote>   <p>robocopy /e /b /copyall d:\TSProfiles <a href="file://\\fs1\d$\TSProfiles">\\fs1\d$\TSProfiles</a>.</p> </blockquote>  <p>This failed with an error:</p>  <blockquote>   <p>ERROR: You do not have the Backup and Restore Files user rights.     <br />***** You need these to perform backup copies (/B or /ZB)</p> </blockquote>  <p>Hmmm. Okay, add myself to the Backup Operators group – same problem. Turns out it was our old friend, the UAC. So, run the Command Prompt “As Administrator” and all is fine with robocopy.</p>  <p>Well, sort of – some of the files copied correctly while others gave an error:</p>  <blockquote>   <p>ERROR 5 (0x00000005) Copying NTFS Security to Destination Directory xxx     <br />Access us denied.</p> </blockquote>  <p>Now, the files had copied but they didn’t have the correct security, so start again.   <br />A little look on the Internet revealed that there are sometimes problems with Robocopy when copying <em>to</em> another server. So, go to FS1 and copy <em>from </em>there instead. Now, this meant I first had to install Robocopy as it is a 2003 server. Robocopy is part of the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=9D467A69-57FF-4AE7-96EE-B18C4790CFFD&amp;displaylang=en">Windows Server 2003 Resource Kit</a>.    <br />Once that was done I ran</p>  <blockquote>   <p>robocopy /b /e /copyall <a href="file://\\ad1\d$\TSProfiles">\\ad1\d$\TSProfiles</a> d:\TSProfiles</p> </blockquote>  <p>and all was well. </p>  <p>Finally, all I had to do was change the Group Policy for&#160; the Terminal Servers to point to the new locations for the Homedrives and the Profiles and log in to each Terminal Server in turn and do a GPUPDATE /FORCE.   <br />In my case, the homedrives and profiles are specified in the Terminal Server Computer policy, <em>not</em> in the user policy applied to the users. More specifically in:</p>  <blockquote>   <p>Computer Configuration/Administrative Templates/Windows Components/Terminal Services/Terminal Server/Profiles</p> </blockquote>  <p>This did work seamlessly, to my surprise, and I would expect that with normal roaming profiles you may have more fun…</p>  
    </div>

    
      
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/2010/03/07/moving-ts-profiles-and-home-drives-to.html';
      this.page.identifier = '/2010/03/07/moving-ts-profiles-and-home-drives-to.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://flytzen.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    

    <a class="u-url" href="/2010/03/07/moving-ts-profiles-and-home-drives-to.html" hidden></a>
  </div>
</article>

    </main>

    <footer class="footer">

  <div class="wrapper">

      <div class="social-links">
        <a href="https://github.com/flytzen" target="_blank">
          <svg style="width:24px;height:24px" viewBox="0 0 24 24" class="social-icon">
            <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
          </svg>
        </a>
        <a href="https://www.linkedin.com/in/flytzen/" target="_blank">
          <svg style="width:24px;height:24px" viewBox="0 0 24 24" class="social-icon">
            <path d="M21,21H17V14.25C17,13.19 15.81,12.31 14.75,12.31C13.69,12.31 13,13.19 13,14.25V21H9V9H13V11C13.66,9.93 15.36,9.24 16.5,9.24C19,9.24 21,11.28 21,13.75V21M7,21H3V9H7V21M5,3A2,2 0 0,1 7,5A2,2 0 0,1 5,7A2,2 0 0,1 3,5A2,2 0 0,1 5,3Z" />
          </svg>
        </a>
        <a href="https://twitter.com/flytzen" target="_blank">
          <svg style="width:24px;height:24px" viewBox="0 0 24 24" class="social-icon">
            <path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" />
          </svg>
        </a>
      </div>

      <div class="copyright">
        &copy; Frans Lytzen 2018
      </div>

  </div>

</footer>


  </body>

</html>
