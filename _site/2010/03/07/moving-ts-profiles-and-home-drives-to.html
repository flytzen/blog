<!DOCTYPE html>
<html lang="en">

  <head>
  <title>Frans' Randomness - Moving TS Profiles and Home Drives to another server</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="format-detection" content="telephone=no" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Frans' Randomness" />
  
  <meta name="description" content="I recently found myself in the situation of having to move the Terminal Server user profiles and the Home Drives directory from one server to another. There are similar challenges involved to moving Roaming Profiles, because you do not have access rights to the user’s profile directory, so you can’t..." />
</head>


  <body>

    <header class="header" role="banner">
  <div class="wrapper">
    
    
    <a class="header__title" rel="author" href="/">Frans&#39; Randomness</a>
    
      <nav class="header__nav">
          <a class="header__nav-link" href="/talks">Talks</a>
          <a class="header__nav-link" href="/blog">Blog</a>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Moving TS Profiles and Home Drives to another server</h1>
    <div class="post-meta">
      <div class="authorandtime">
        <time class="dt-published" datetime="2010-03-07T21:45:00+00:00" itemprop="datePublished">
          
          Mar 7, 2010
        </time>
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Frans Lytzen</span></span>
        
      </div>
      <div class="post-tags">
        
        <a href="/tags/#Technology">Technology</a>
        
        
      </div>
    </div>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I recently found myself in the situation of having to move the Terminal Server user profiles and the Home Drives directory from one server to another. There are similar challenges involved to moving Roaming Profiles, because you do not have access rights to the user’s profile directory, so you can’t just copy the data.</p>  <p>In short, you need to use </p>  <blockquote>   <p>robocopy /e /b /copyall </p> </blockquote>  <p>to copy the folder from one server to another.    <br />After the files are copied, you should be able to just update the Terminal Server Group Policy with the new locations.</p>  <p>But, let me take you through the hoops I had to go through, just in case you have some of the same issues.</p>  <p>The TSProfiles and HomeDrives resided on a Windows Server 2008 server (AD1) and I wanted to move them to a Windows Server 2003 Server (FS1). </p>  <p>Robocopy is included in Windows Server 2008 so I decided to try to do the copy from the 2008 server like this;</p>  <blockquote>   <p>robocopy /e /b /copyall d:\TSProfiles <a href="file://\\fs1\d$\TSProfiles">\\fs1\d$\TSProfiles</a>.</p> </blockquote>  <p>This failed with an error:</p>  <blockquote>   <p>ERROR: You do not have the Backup and Restore Files user rights.     <br />***** You need these to perform backup copies (/B or /ZB)</p> </blockquote>  <p>Hmmm. Okay, add myself to the Backup Operators group – same problem. Turns out it was our old friend, the UAC. So, run the Command Prompt “As Administrator” and all is fine with robocopy.</p>  <p>Well, sort of – some of the files copied correctly while others gave an error:</p>  <blockquote>   <p>ERROR 5 (0x00000005) Copying NTFS Security to Destination Directory xxx     <br />Access us denied.</p> </blockquote>  <p>Now, the files had copied but they didn’t have the correct security, so start again.   <br />A little look on the Internet revealed that there are sometimes problems with Robocopy when copying <em>to</em> another server. So, go to FS1 and copy <em>from </em>there instead. Now, this meant I first had to install Robocopy as it is a 2003 server. Robocopy is part of the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=9D467A69-57FF-4AE7-96EE-B18C4790CFFD&amp;displaylang=en">Windows Server 2003 Resource Kit</a>.    <br />Once that was done I ran</p>  <blockquote>   <p>robocopy /b /e /copyall <a href="file://\\ad1\d$\TSProfiles">\\ad1\d$\TSProfiles</a> d:\TSProfiles</p> </blockquote>  <p>and all was well. </p>  <p>Finally, all I had to do was change the Group Policy for&#160; the Terminal Servers to point to the new locations for the Homedrives and the Profiles and log in to each Terminal Server in turn and do a GPUPDATE /FORCE.   <br />In my case, the homedrives and profiles are specified in the Terminal Server Computer policy, <em>not</em> in the user policy applied to the users. More specifically in:</p>  <blockquote>   <p>Computer Configuration/Administrative Templates/Windows Components/Terminal Services/Terminal Server/Profiles</p> </blockquote>  <p>This did work seamlessly, to my surprise, and I would expect that with normal roaming profiles you may have more fun…</p>  
  </div>

  
    
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/2010/03/07/moving-ts-profiles-and-home-drives-to.html';
      this.page.identifier = '/2010/03/07/moving-ts-profiles-and-home-drives-to.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://flytzen.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


  

  <a class="u-url" href="/2010/03/07/moving-ts-profiles-and-home-drives-to.html" hidden></a>
</article>

      </div>
    </main>

    <!-- <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Frans&#39; Randomness</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            Frans Lytzen
            </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/flytzen"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">flytzen</span></a></li>
  
  <li><a href="https://www.linkedin.com/in/flytzen"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">flytzen</span></a></li>
  
  <li><a href="https://www.twitter.com/flytzen"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">flytzen</span></a></li>
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>My very infrequent thoughts on the world of software development</p>
      </div>
    </div>

  </div>

</footer> -->


  </body>

</html>
