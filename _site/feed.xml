<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="https://www.lytzen.name/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.lytzen.name/" rel="alternate" type="text/html" /><updated>2021-03-17T08:38:59+00:00</updated><id>https://www.lytzen.name/</id><title type="html">Frans’ Randomness</title><subtitle>My very infrequent thoughts on the world of software development</subtitle><entry><title type="html">Log Analytics to the rescue</title><link href="https://www.lytzen.name/2021/03/17/log-analytics-to-the-rescue.html" rel="alternate" type="text/html" title="Log Analytics to the rescue" /><published>2021-03-17T00:00:00+00:00</published><updated>2021-03-17T00:00:00+00:00</updated><id>https://www.lytzen.name/2021/03/17/log-analytics-to-the-rescue</id><content type="html" xml:base="https://www.lytzen.name/2021/03/17/log-analytics-to-the-rescue.html">&lt;p&gt;TL;DR; You can log all the request to Azure CosmosDB to Log Analytics so you can analyse where the requests are coming from.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Background&lt;/strong&gt;: One of the systems we build and run on Azure for one of our clients, we had a problem when deploying a new version. As soon as the new version was deployed, performance would fall to unusable levels. We could not reproduce this in any test environments, it only happened in live. We figured out that the problem was most likely caused by the CosmosDB running at capacity and something in the new release just added a tiny bit of extra load that tipped it over the edge. We could see in Azure that the CosmosDB was running at 80%-100% utilisation, though with a very low level of throttling.&lt;/p&gt;

&lt;p&gt;The application uses Application Insights, so we used that to &lt;a href=&quot;https://www.lytzen.name/2019/05/20/find-select-nplus1-with-app-insights.html&quot;&gt;look for excessive use from the application&lt;/a&gt; - but there was nothing out of the ordinary.&lt;/p&gt;

&lt;p&gt;Application Insights is built on top of Log Analytics and uses the same engine for log ingestion. They both share the same, very powerful, query language that can be used to quickly analyse and visualise large log volumes. Application Insights is primarily about applications, but many more things can log directly to Log Analytics - including CosmosDB and Azure SQL.&lt;/p&gt;

&lt;h1 id=&quot;switching-on-diagnostics&quot;&gt;Switching on Diagnostics&lt;/h1&gt;
&lt;p&gt;We created a new Log Analytics workspace and then told CosmosDB to log all requests to that workspace:
&lt;img src=&quot;../assets/loganalytics/diagnosticsettings.png&quot; alt=&quot;Diagnostic Settings&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;analysing-the-data&quot;&gt;Analysing the data&lt;/h1&gt;
&lt;p&gt;After waiting an hour to get some data to work with, we wrote a few queries:&lt;/p&gt;

&lt;h2 id=&quot;who-is-sending-most-requests&quot;&gt;Who is sending most requests?&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;../assets/loganalytics/numrequests.png&quot; alt=&quot;Request Count&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can see that Power BI is responsible for about 11% of the requests. Not too bad, but still quite high.&lt;/p&gt;

&lt;h2 id=&quot;who-is-using-the-most-request-units&quot;&gt;Who is using the most Request Units?&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;../assets/loganalytics/requestunits.png&quot; alt=&quot;Request Units&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Wow, so PowerBI is using ~70% of the total capacity on CosmosDB. That is definitely a problem.&lt;/p&gt;

&lt;h2 id=&quot;how-often-is-powerbi-making-requests&quot;&gt;How often is PowerBI making requests?&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;../assets/loganalytics/requestperminute.png&quot; alt=&quot;Requests per minute&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The client told us that they have a number of PowerBI reports that auto refresh - but they are not supposed to refresh very often. Despite that, we can see that PowerBI makes more than 250 requests per minute so something is amiss.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;In this case, we concluded that some of the client’s PowerBI reports were poorly written, meaning they downloaded vast amounts of data and did the filtering on the client side. 
CosmosDB has a limit on how many documents you can receive per request, so when PowerBI nominally does a single call to get a large amount of data, it will cause a large number of sequential calls to the database to get all the data. This also fits the pattern we saw where the database was under high load, but with little throttling.&lt;/p&gt;

&lt;p&gt;Incidentally, it is very easy to write PowerBI reports that kill the database. It is essential to hand-craft a SELECT statement to limit the data both vertically and horizontally before it is pulled into the visual designer.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="azure" /><summary type="html">I love Application Insights, but sometimes you need to go a bit deeper</summary></entry><entry><title type="html">Azure SQL Private End Points with Pulumi</title><link href="https://www.lytzen.name/2021/02/16/pulumi-sql-private-end-point.html" rel="alternate" type="text/html" title="Azure SQL Private End Points with Pulumi" /><published>2021-02-16T00:00:00+00:00</published><updated>2021-02-16T00:00:00+00:00</updated><id>https://www.lytzen.name/2021/02/16/pulumi-sql-private-end-point</id><content type="html" xml:base="https://www.lytzen.name/2021/02/16/pulumi-sql-private-end-point.html">&lt;p&gt;Private End Points are the right way to connect PaaS Services to vNets so they can be accessed from other resources on the vNet. There are other, older, ways but they are not as good. Unfortunately, Private End Points require understanding quite a few things, including DNS resolution, split-brain DNS and a bunch of weird abstractions. 
This &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/private-link/create-private-endpoint-cli&quot;&gt;Microsoft post&lt;/a&gt; gives a good example of how to set it up with Azure SQL. This post does essentially the same thing, except it does not create a VM. Anything related to the VM is left out here.&lt;/p&gt;

&lt;p&gt;This is part of a &lt;a href=&quot;https://github.com/NewOrbit/AzureVnetPassSamples&quot;&gt;bigger project&lt;/a&gt; I am working on to set up a complex vNet-and-PasS setup in Azure with multiple services, regions and VPN clients.&lt;/p&gt;

&lt;h1 id=&quot;before-we-can-add-the-private-end-point&quot;&gt;Before we can add the private end point&lt;/h1&gt;
&lt;p&gt;This bit here sets up a network and a SQL Server so we can add the private end point.&lt;/p&gt;

&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ResourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;vnet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;VirtualNetwork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-vn&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtualNetworkName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-vn&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;addressSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;addressPrefixes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;10.0.0.0/16&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azureSqlSubnet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Subnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;azure-sql&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;subnetName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;azure-sql&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;na&quot;&gt;addressPrefix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;10.0.4.0/24&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtualNetworkName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;vnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateEndpointNetworkPolicies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Disabled&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;passSqlServer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;v20200801preview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-ss&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;serverName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-ss&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;administratorLogin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;administratorLoginPassword&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;minimalTlsVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;1.2&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;setting-up-the-private-end-point&quot;&gt;Setting up the private end point&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;This is the important bit&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;first-add-a-private-dns-zone-and-link-it-to-the-network&quot;&gt;First, add a Private DNS Zone and link it to the network&lt;/h3&gt;
&lt;p&gt;You need to do this &lt;em&gt;once&lt;/em&gt; per vnet, no matter how many SQL Servers you have in that vNet. You will need to do this for each type of service, i.e you’d need something similar for Storage etc. This is required in order to make DNS lookups for the SQL Server return the &lt;em&gt;local&lt;/em&gt; IP address, rather than the public one. The tricky bit is that an Azure SQL Server will always have a &lt;em&gt;public&lt;/em&gt; IP Address, even if no public access is allowed. When you set up the DNS resolution just right, a DNS lookup on your private network will return the private IP address and when you look it up on the public internet, you will see the public IP address. There is a lot more detail to this, but that is for another post. What is described here is the easiest and most reliable way to make this work. There &lt;em&gt;are&lt;/em&gt; other ways, but they require more knowledge and more work.&lt;/p&gt;

&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Sets up a private DNS Zone for SQL private link entries&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateDns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PrivateZone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-sqldns&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateZoneName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;privatelink.database.windows.net&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;global&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//https://github.com/Azure/azure-cli/issues/6052&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Links the private DNS Zone to the vnet&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dnsVnetLink&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;VirtualNetworkLink&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-vnl&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateZoneName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateDns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtualNetworkLinkName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-vnl&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;registrationEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtualNetwork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;vnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;global&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;set-up-a-private-end-point-for-the-sql-server&quot;&gt;Set up a Private End Point for the SQL Server&lt;/h3&gt;
&lt;p&gt;You need to do this for each SQL Server in your vnet&lt;/p&gt;
&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Create the private end point for the SQL Server&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateEndPoint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PrivateEndpoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-sqlpep&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateEndpointName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-sqlpep&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;subnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azureSqlSubnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateLinkServiceConnections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;privateLinkServiceId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;passSqlServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;groupIds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;sqlServer&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// This particular group id is not documented by Azure that I can see - I found it by trying to do this manually in the portal&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;privateLinkServiceConnectionState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;actionsRequired&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Auto-approved&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Approved&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Connects the private DNS Zone and the private end point (I think)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateDnsZoneGroup&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PrivateDnsZoneGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-sqldnsgroup&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateDnsZoneGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-sqldnsgroup&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateEndpointName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateEndPoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-sqldns&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;privateDnsZoneConfigs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateDns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;privateDnsZoneId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sqlPrivateDns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;connect-a-web-app&quot;&gt;Connect a Web App&lt;/h1&gt;
&lt;p&gt;If you want to connect a web app to the vNet so it can talk to the SQL (not really the scope of this post, but hey) then do the following. Note, this is &lt;em&gt;outbound&lt;/em&gt; from the Web App. Inbound traffic &lt;em&gt;to&lt;/em&gt; the Web App is best handled by setting up a Private End Point for the Web App - though that currently requires a Premium App Service Plan. Service End Points is another option but they are much harder to use in my experience and I don’t recommend them.&lt;/p&gt;

&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Set up a subnet dedicated as an entry point for Web Apps&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;frontEndSubnet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Subnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;front-end&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;subnetName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;front-end&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;addressPrefix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;10.0.1.0/24&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;virtualNetworkName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;vnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;delegations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Microsoft.Web/serverfarms&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;front-end-delegation&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Add an app service plan and a web app&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;appServicePlan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppServicePlan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-as&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-as&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;sku&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;capacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;S1&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;S1&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;appService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WebApp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-wa&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-wa&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;clientAffinityEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;httpsOnly&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;serverFarmId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;appServicePlan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;siteConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;appSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// This is critical to make DNS lookups return the internal IP Address. &lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// Without it, your web app will get the public IP address of the SQL Server and will be denied access. &lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// 168.63.129.16 is a magic constant provided by Microsoft and works with the setup above. &lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// You will only need something different if you use your own DNS servers.&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// See https://feedback.azure.com/forums/169385-web-apps/suggestions/38383642-web-app-and-private-dns-zone-support&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;WEBSITE_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;168.63.129.16&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; 
                &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;WEBSITE_VNET_ROUTE_ALL&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;passSqlServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.database.windows.net&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;sql&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Server=tcp:fl-vnettest-ss.database.windows.net,1433;Initial Catalog=fl-vnettest-db;Persist Security Info=False;User ID=&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;administratorLogin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;;Password=&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;administratorLoginPassword&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
                    &lt;span class=&quot;c1&quot;&gt;// Note: This isn't ideal for many reasons, but I haven't got the brain power to nest apply calls :)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;    
            &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Give the web app access to the vnet &amp;lt;- the thing you actually wanted to see :)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Note that &quot;Swift&quot; is the &quot;modern&quot; way of doing this. Don't do what I do and spend ours trying to make WebAppVnetConnection work - it won't.&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;webAppVNetConnection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;azure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WebAppSwiftVirtualNetworkConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;fl-vnettest-wa-vc&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;appService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;resourceGroupName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;subnetResourceId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;frontEndSubnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.pulumi.com/docs/reference/pkg/azure-nextgen/&quot;&gt;Pulumi Azure Next Gen API Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/azure/private-link/create-private-endpoint-cli&quot;&gt;Quickstart: Create a Private Endpoint using Azure CLI&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/pulumi/pulumi-azure-nextgen/issues/227&quot;&gt;Unable to provision PrivateDnsZoneGroup&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/NewOrbit/AzureVnetPassSamples&quot;&gt;AzureVnetPassSamples repo (work in progress)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://feedback.azure.com/forums/169385-web-apps/suggestions/38383642-web-app-and-private-dns-zone-support&quot;&gt;Web App and Private DNS zone support&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Frans Lytzen</name></author><category term="Azure" /><category term="Pulumi" /><category term="Network" /><category term="Security" /><summary type="html">Configure Private End Points on Azure SQL Server with Pulumi</summary></entry><entry><title type="html">Azure Private End Points, VPNs and multi-site</title><link href="https://www.lytzen.name/2020/03/23/private-endpoints-vpn-and-more.html" rel="alternate" type="text/html" title="Azure Private End Points, VPNs and multi-site" /><published>2020-03-23T00:00:00+00:00</published><updated>2020-03-23T00:00:00+00:00</updated><id>https://www.lytzen.name/2020/03/23/private-endpoints-vpn-and-more</id><content type="html" xml:base="https://www.lytzen.name/2020/03/23/private-endpoints-vpn-and-more.html">&lt;p&gt;&lt;em&gt;NOTE: Right now this is not a finished post - I haven’t yet figured out how to make this work. I have written it up here partially to be able to raise a support query.&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&quot;this-is-what-i-am-trying-to-achieve&quot;&gt;This is what I am trying to achieve&lt;/h1&gt;
&lt;div style=&quot;width: 640px; height: 480px; margin: 10px; position: relative;&quot;&gt;&lt;iframe allowfullscreen=&quot;&quot; frameborder=&quot;0&quot; style=&quot;width:640px; height:480px&quot; src=&quot;https://www.lucidchart.com/documents/embeddedchart/41848683-692d-4268-bc3f-e4d9ab764098&quot; id=&quot;Pt~IQN7FkdqC&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;I have a database in the Europe North and another one in Australia East. I have users in both geographies and they need to be able to access both databases in order to write PowerBI reports. Ideally I want the users in both locations to be able to connect to a local VPN Gateway to avoid unnecessary roundtrips; at the distances we are talking about, latency becomes a real issue.&lt;/p&gt;

&lt;p&gt;Until fairly recently the only way to do this was to open up the user’s IP address on the SQL Firewall. Fortunately, with the advent of Private Link / Private Endpoint, you can now connect to Azure SQL via a VPN client.&lt;/p&gt;

&lt;p&gt;The complication is that that a virtual network cannot span multiple data centres, so you have to connect them using either “virtual network peering” or “virtual network gateway connections”. I have tried both and they come with different trade-offs.&lt;/p&gt;

&lt;h1 id=&quot;peering&quot;&gt;Peering&lt;/h1&gt;
&lt;p&gt;Virtual networks can be &lt;em&gt;peered&lt;/em&gt;. The setup here is based on &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-peering-gateway-transit&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt;
&lt;div style=&quot;width: 640px; height: 480px; margin: 10px; position: relative;&quot;&gt;&lt;iframe allowfullscreen=&quot;&quot; frameborder=&quot;0&quot; style=&quot;width:640px; height:480px&quot; src=&quot;https://www.lucidchart.com/documents/embeddedchart/2eb8492a-7b8b-4410-a4f8-9b386194dabc&quot; id=&quot;vC~I0fkY7VUW&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;p&gt;In this setup, I have created two peerings:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;One going from Europe to Australia which has “Allow Gateway Transit” set.&lt;/li&gt;
  &lt;li&gt;One going from Australia to Europe which has “Use Remote Gateways” set.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;what-works&quot;&gt;What works&lt;/h2&gt;
&lt;p&gt;I can connect to the Europe Gateway and connect to the database in both locations. That is a success.&lt;/p&gt;

&lt;p&gt;When I connect to the Azure VPN client, I can see in the &lt;code class=&quot;highlighter-rouge&quot;&gt;AzureVpnCxn.log&lt;/code&gt; that I get both the 10.0.0.0/16 and the 10.1.0.0/16 routes.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Received option: route 10.0.0.0 255.255.0.0
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Assigned Route: 10.0.0.0 / 255.255.0.0
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Received option: route 10.1.0.0 255.255.0.0
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Assigned Route: 10.1.0.0 / 255.255.0.0
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Received option: route-gateway 172.16.10.1
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Received option: topology subnet
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Received option: ifconfig 172.16.10.2 255.255.255.128
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Assigned IP address: 172.16.10.2 / 255.255.255.128
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Assigned Route: 172.16.10.0 / 255.255.255.128
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00024864] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Received option: cipher AES-256-GCM
[‎3‎/‎23‎/‎2020‎ ‎1‎:‎28‎:‎14‎ ‎PM] PId:[00025864] TId:[00010832] [momenta-live-eun] [{cd712a18-c0d7-482c-9f11-7404ad0c7b1b}] [Verbose] Session established!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;what-doesnt-work&quot;&gt;What doesn’t work&lt;/h2&gt;
&lt;p&gt;This setup is designed for a “hub and spoke” architecture; Setting the “Use Remote Gateways” setting explicitly disallows me from having a Gateway in Australia. In other words, my Australia users have to connect to the VPN Gateway in Europe, which means they’ll suffer double latency when querying the Australia database.&lt;br /&gt;
If you don’t set the “Use Remote Gateways” options, you won’t get the 10.1.0.0/16 route when you connect with the Azure VPN Client.&lt;/p&gt;

&lt;h1 id=&quot;gateway-connection&quot;&gt;Gateway Connection&lt;/h1&gt;
&lt;p&gt;In this setup, you use Gateway Connections between the two networks.&lt;/p&gt;
&lt;div style=&quot;width: 640px; height: 480px; margin: 10px; position: relative;&quot;&gt;&lt;iframe allowfullscreen=&quot;&quot; frameborder=&quot;0&quot; style=&quot;width:640px; height:480px&quot; src=&quot;https://www.lucidchart.com/documents/embeddedchart/54b1279f-d5f1-4513-9e5b-a8346ab78cc6&quot; id=&quot;QD~Ipb0I~VxK&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;h2 id=&quot;what-works-1&quot;&gt;What works&lt;/h2&gt;
&lt;p&gt;I get the routes served to me, from the &lt;code class=&quot;highlighter-rouge&quot;&gt;AzureVpnCxn.log&lt;/code&gt; I get this:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Received option: route 10.0.0.0 255.255.0.0
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Assigned Route: 10.0.0.0 / 255.255.0.0
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Received option: route 10.1.0.0 255.255.0.0
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Assigned Route: 10.1.0.0 / 255.255.0.0
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Received option: route-gateway 172.16.10.1
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Received option: topology subnet
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Received option: ifconfig 172.16.10.3 255.255.255.128
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Assigned IP address: 172.16.10.3 / 255.255.255.128
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Assigned Route: 172.16.10.0 / 255.255.255.128
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00018256] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Received option: cipher AES-256-GCM
[‎3‎/‎20‎/‎2020‎ ‎4‎:‎51‎:‎21‎ ‎PM] PId:[00011592] TId:[00012216] [momenta-live-eun] [{7412cb8b-e91a-4757-8f1f-c32c4406248e}] [Verbose] Session established!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;This is exactly the same as when I used peerings&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;what-doesnt-work-1&quot;&gt;What doesn’t work&lt;/h2&gt;
&lt;p&gt;When I connect to the Europe Gateway, I am &lt;em&gt;not&lt;/em&gt; able to connect to the Australia database; the connection simply times out. I suspect that the remote network is unable to respond, because:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The Europe -&amp;gt; Australia Gateway connection shows that it has data going &lt;em&gt;out&lt;/em&gt; but 0 bytes data &lt;em&gt;in&lt;/em&gt;.&lt;/li&gt;
  &lt;li&gt;The Australia -&amp;gt; Europe Gateway connection shows that it has data coming &lt;em&gt;in&lt;/em&gt; but 0 bytes data &lt;em&gt;out&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;notes&quot;&gt;Notes&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;I don’t know why you have to create two connections, one for each direction.&lt;/li&gt;
  &lt;li&gt;You can enable &lt;code class=&quot;highlighter-rouge&quot;&gt;Border Gateway Protocol&lt;/code&gt; (BGP) on the gateways. Interestingly, if you do that, you &lt;em&gt;don’t&lt;/em&gt; get the route for the remote network when you connect to the VPN Client. Still, you can’t connect to the remote database.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;naming-and-certificates&quot;&gt;Naming and certificates&lt;/h1&gt;
&lt;p&gt;There’s another whole set of problems about DNS names and SQL Server certificates.&lt;br /&gt;
The SQL Server has a &lt;em&gt;public&lt;/em&gt; IP address, but Private Link also gives it a &lt;em&gt;Private&lt;/em&gt; IP address. In my example here, they are 10.0.1.4 and 10.1.1.4 respectively. When you connect to the SQL Server over the VPN, you need to use the private IP address. So you may think you can just type 10.0.1.4 into PowerBI and start connecting. You will unfortunately get an “Encryption Support” error saying “The server name provided doesn’t match the server name on the SQL Server SSL certificate”.&lt;/p&gt;

&lt;p&gt;This makes sense; The SQL Server has a certificate that has been issued to &lt;code class=&quot;highlighter-rouge&quot;&gt;mydatabase.database.windows.net&lt;/code&gt; (just like a website would) and when you try to connect to &lt;code class=&quot;highlighter-rouge&quot;&gt;10.0.1.4&lt;/code&gt;, you get an error - just like you would in a web browser in the same situation.&lt;/p&gt;

&lt;p&gt;I am preparing a longer post on it, but the short version is this:
&lt;code class=&quot;highlighter-rouge&quot;&gt;mydatabase.database.windows.net&lt;/code&gt; is just a CNAME that points to &lt;code class=&quot;highlighter-rouge&quot;&gt;mydatabase.privatelink.database.windows.net&lt;/code&gt;.
You need to override the DNS resolution for the latter in your in your local DNS and then you can just connect to &lt;code class=&quot;highlighter-rouge&quot;&gt;mydatabase.database.windows.net&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;I haven’t (yet) been able to show that you can override the &lt;code class=&quot;highlighter-rouge&quot;&gt;privatelink&lt;/code&gt; entry in your HOSTS file and make it work; I am not sure it participates in the DNS chain in the same way. If you need to use a HOSTS file, you may need to override &lt;code class=&quot;highlighter-rouge&quot;&gt;mydatabase.database.windows.net&lt;/code&gt;. More testing coming…&lt;/p&gt;

&lt;p&gt;Azure has support for Private DNS Zones - I am not sure they are applied to VPN clients yet. I’ll test and update this post when I know.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Azure" /><summary type="html">Azure Private End Points, VPN clients and multi-region setups.</summary></entry><entry><title type="html">Retain team members - or not</title><link href="https://www.lytzen.name/2020/02/20/retain-team-members.html" rel="alternate" type="text/html" title="Retain team members - or not" /><published>2020-02-20T00:00:00+00:00</published><updated>2020-02-20T00:00:00+00:00</updated><id>https://www.lytzen.name/2020/02/20/retain-team-members</id><content type="html" xml:base="https://www.lytzen.name/2020/02/20/retain-team-members.html">&lt;p&gt;&lt;em&gt;Disclaimer: This is not a how-to on how to retain team members by giving them free coffee or other gimmicks like that. It’s not even about retaining at all cost.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Many years ago I worked for a small company that was bought by Microsoft.&lt;br /&gt;
One day we had an employee survey - one of the questions on it was “Do you intend to work for Microsoft until you retire”. Most of our newly-bought business said no and, predictably, we had a report back from corp that highlighted this as a potential morale problem in our area.
I, and most of the team, disagreed. In our minds, having most of the team saying that, yes, they do want to stay in the same company until they retire would have been a serious concern that something was wrong.&lt;/p&gt;

&lt;p&gt;The relationship between an employee and their manager is in part a human-to-human relationship and a lot of the same emotions go into it as in any other such relationship, including feelings of loyalty, expectations, betrayal and so much more.&lt;br /&gt;
For most employees, it can be emotionally hard to actually hand in their resignation (no matter whether they like their manager or not) and for most managers it feels like a body blow to receive a resignation letter.&lt;/p&gt;

&lt;p&gt;Whether you hate each other or have a great working relationship, it still feels like leaving a partner with all the emotional baggage that comes with that. On top of that, from the managers point of view, there are all the additional concerns, such as losing the skills of the team member, having to recruit and worrying about what their manager will think of them for “losing” an employee.&lt;/p&gt;

&lt;p&gt;It shouldn’t be like that.&lt;/p&gt;

&lt;h1 id=&quot;another-way-to-think-about-it&quot;&gt;Another way to think about it&lt;/h1&gt;
&lt;p&gt;We are all part of each other’s journeys.&lt;/p&gt;

&lt;p&gt;When someone works for me, I think of it as a time-limited, mutually beneficial relationship. While that person is working for me, I’ll expect them grow and learn, developing both themselves and their career. My job as a manager is to support that growth and that journey whilst making sure the company benefit from what that person brings. There is a balance to be achieved there; companies are not charities and need to get value from the people who work for them. At the same time, though, helping a person grow helps retain them (at least for now), helps them add more value and - crucially - helps attract new talent to the organisation.&lt;/p&gt;

&lt;p&gt;Eventually, that person will want to take their career in a different direction - or there may simply not be an opportunity for them to continue to grow in my organisation. There can be many reasons for this, all dependent on the team member’  s abilities and aspirations as well as my company’s particular situation and needs. At that point, it doesn’t suit either me or the team member for them to stay; they’ll be unhappy that they are not doing what they really want and I will be perpetually worried about losing them as well as constantly having to deal with them being unhappy.&lt;/p&gt;

&lt;p&gt;When you get to that point, it is much better to agree that it’s time to move on and work on it together. 
For me, it’s always gut-wrenching to lose a team member, but I am also always very happy to watch them succeed in other places, especially when I feel I had some role in helping them on their journey.&lt;/p&gt;

&lt;p&gt;The horrible situations are the ones where you &lt;em&gt;can&lt;/em&gt; provide the journey the person is seeking but they didn’t realise. Then you lose a valuable team member for no reason - and they miss out on the opportunity to keep growing, quite possibly faster, in an environment they already know.&lt;/p&gt;

&lt;h1 id=&quot;what-we-should-do&quot;&gt;What we should do&lt;/h1&gt;
&lt;p&gt;I’ll be the first to say that I am not great at applying this consistently - this is what I aspire to do. As a teacher once said to me; Do what I say, not what I do ;)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Make sure it’s understood in your organisation that you can have unemotional conversations about career development, including conversations about moving on, without fear.&lt;/li&gt;
  &lt;li&gt;Have clear and regular conversations with each team member about what their aspirations are and how you can help them get there. Or explain why you don’t think they can get there, whether that’s to do with their abilities or the constraints of the organisation.&lt;/li&gt;
  &lt;li&gt;Put measurable, actionable plans in place; This is where I fail most often. It’s relatively easy to have the conversation but converting it into a plan with dates and milestones that you can hold each other accountable to is hard work.&lt;/li&gt;
  &lt;li&gt;If someone does resign unexpectedly (or you are afraid they might) - have the conversation about aspirations and options. If there is room for accommodating their journey within your organisation and it fits - work really hard to retain them. If, on the other hand, you can’t see a meaningful journey for them, just end it there; It’s counterproductive to make them stay just to avoid a short-term problem.&lt;/li&gt;
  &lt;li&gt;Don’t ever let yourself fall prey to “I can’t afford to lose that person from that role so I won’t move them to some other role”. If you do that, you just ensure they’ll leave your organisation altogether.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;a-place-for-just-doing-my-job&quot;&gt;A place for “just doing my job”?&lt;/h1&gt;
&lt;p&gt;My whole argument here is based on the idea that everyone has to continually grow and change throughout their career. But what if you just want to continue doing the same job until you retire? Honestly, I am biased because in the industry I work in, both individuals and organisations have to continually renew themselves. 10-year old skills are rarely marketable in this industry (with some notable and extremely valuable skills - but even those are not what you want to build your retirement plan on).&lt;/p&gt;

&lt;p&gt;Do those jobs still exist in other organisations? Maybe… I think the world is now changing so fast that very few jobs can be expected to stay the same over any 10 year period. I do think this will be the cause of considerably social anxiety and disruption, but that’s a discussion for another day.&lt;/p&gt;

&lt;h1 id=&quot;footnote&quot;&gt;Footnote&lt;/h1&gt;
&lt;p&gt;It’s a shame that it is so hard to have these conversations in practice. Thinking about leaving a job is uncomfortably like thinking about leaving your partner. You probably wouldn’t have a chat with your spouse about whether it would be best to split up unless you are already pretty sure that it is. But working relationships are &lt;em&gt;not&lt;/em&gt; marriages. You should explicitly expect them to end at some point.&lt;/p&gt;

&lt;p&gt;You are part of each others journey for a while, both sides benefiting from the relationship both in terms of money/work and in terms of personal/organisational growth.&lt;br /&gt;
If we can separate personal relationship and the feelings of personal loyalty and betrayal from the conversations, then I think we would all be better of.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Management" /><summary type="html">Another way to think about the relationship between your company and your employees.</summary></entry><entry><title type="html">Azure Key Vault Secrets</title><link href="https://www.lytzen.name/2019/12/07/azure-keyvault-secrets.html" rel="alternate" type="text/html" title="Azure Key Vault Secrets" /><published>2019-12-07T00:00:00+00:00</published><updated>2019-12-07T00:00:00+00:00</updated><id>https://www.lytzen.name/2019/12/07/azure-keyvault-secrets</id><content type="html" xml:base="https://www.lytzen.name/2019/12/07/azure-keyvault-secrets.html">&lt;p&gt;&lt;a href=&quot;https://azureadventcalendar.com/&quot;&gt;Azure Advent Calendar 2019&lt;/a&gt; is a great initiative to generate and share a bunch of Azure content.
I was fortunate enough to be able to create a video about Azure Key Vault for the Advent Calendar. Specifically, this video focuses on storing &lt;em&gt;secrets&lt;/em&gt; in Azure Key Vault.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/SIA3pleuqfQ&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Please check out all the &lt;a href=&quot;https://www.youtube.com/channel/UCJL9wCcmeMBbah4J0uOWIPg&quot;&gt;other great content and subscribe to the channel&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;content&quot;&gt;Content&lt;/h1&gt;
&lt;p&gt;The broad outline of the video is as follows:&lt;/p&gt;

&lt;h2 id=&quot;what-is-azure-key-vault&quot;&gt;What is Azure Key Vault?&lt;/h2&gt;
&lt;p&gt;Azure Key Vault provides the following, quite separate, areas of functionality:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Secrets: Safe place to store passwords and other secrets&lt;/li&gt;
  &lt;li&gt;Keys / Cryptography: Public/Private key encryption&lt;/li&gt;
  &lt;li&gt;Certificate Store: Safe place to store X509 certificates&lt;/li&gt;
  &lt;li&gt;Storage Account key rotation: Essentially a wrapper around “Secrets” to help you manage and rotate you Azure Storage Account keys.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;azure-key-vault-secrets&quot;&gt;Azure Key Vault Secrets&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Store and retrieve secrets&lt;/li&gt;
  &lt;li&gt;Fine-grained access control
    &lt;ul&gt;
      &lt;li&gt;For example, write-only access to a user, read-only access to an app&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Auth is easy with Managed Identity&lt;/li&gt;
  &lt;li&gt;Store multiple versions with stop/start dates etc
    &lt;ul&gt;
      &lt;li&gt;The dates are advisory and your code has to decide whether to read and use them&lt;/li&gt;
      &lt;li&gt;Uniquely reference specific versions&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;before-you-start-with-the-examples&quot;&gt;Before you start with the examples&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest&quot;&gt;Install the Azure CLI &lt;/a&gt;&lt;br /&gt;
&lt;em&gt;Note: I use the PowerShell line continuation character below - if you run this in bash you need to change that&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az login
az account set --subscription xxxx
az configure --defaults location=westeurope group=fl-test-keyvault
az group create --name fl-test-keyvault
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;create-a-key-vault&quot;&gt;Create a Key Vault&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az keyvault create --name fl-test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;give-read-and-write-permissions-to-a-user&quot;&gt;Give read and write permissions to a user&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az keyvault set-policy `
    --name fl-test `
    --upn &quot;flytzen@neworbit.co.uk&quot; `
    --secret-permissions get, list, set  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the real world, a consuming application should not have “set” and an admin shouldn’t have get&lt;/p&gt;

&lt;h2 id=&quot;add-a-secret&quot;&gt;Add a secret&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;You can do this in the portal as well - and in code of course&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az keyvault secret set `
    --name supersecretpassword `
    --vault-name fl-test `
    --value ohmyworditssosecret `
    --not-before 2019-12-03T14:30:25z `
    --expires 2019-12-24T23:59:59z `
    --disabled false `
    --output table
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that the “disabled” flag is enforced; most operations are blocked on a disabled secret.
However, the nbf and expiry are for information and it’s up to you to read them and act on them
This is &lt;em&gt;different&lt;/em&gt; for keys!&lt;/p&gt;

&lt;h2 id=&quot;set-up-a-console-app-to-read-the-secret&quot;&gt;Set up a console app to read the secret&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Note: New packages have just come out but they have &lt;a href=&quot;https://github.com/Azure/azure-sdk-for-net/issues/8934&quot;&gt;less intuitive auth&lt;/a&gt; - for now&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dotnet new console -n ShowSecrets 
cd ShowSecrets 
dotnet add package Microsoft.Azure.KeyVault
dotnet add package Microsoft.Azure.Services.AppAuthentication
code .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;fields&quot;&gt;Fields&lt;/h2&gt;
&lt;p&gt;Add the following to the top of the Main class:&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyVaultUrl&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://fl-test.vault.azure.net&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;supersecretname&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;supersecretpassword&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;simple-program-to-retrieve-secret&quot;&gt;Simple program to retrieve secret&lt;/h2&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokenProvider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AzureServiceTokenProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyVaultClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;KeyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
               &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AuthenticationCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokenProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KeyVaultTokenCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secretValue&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetSecretAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyVaultUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;supersecretname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;change-the-secret-in-the-cli&quot;&gt;Change the secret in the CLI&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az keyvault secret set `
    --name supersecretpassword `
    --vault-name fl-test `
    --value OXFORD `
    --not-before 2019-12-24T14:30:25z `
    --expires 2019-12-31T23:59:59z `
    --disabled false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;see-all-the-versions&quot;&gt;See all the versions&lt;/h2&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokenProvider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AzureServiceTokenProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyVaultClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;KeyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                 &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AuthenticationCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokenProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KeyVaultTokenCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secretVersions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetSecretVersionsAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyVaultUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;supersecretname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secretVersion&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secretVersions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secretVersionValue&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetSecretAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; | &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Attributes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Enabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; | &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Attributes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NotBefore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; | &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Attributes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expires&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; | &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretVersionValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;try-it-in-aspnet-core&quot;&gt;Try it in ASP.Net Core&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dotnet new mvc
dotnet add package Microsoft.Azure.KeyVault
dotnet add package Microsoft.Azure.Services.AppAuthentication
dotnet add package Microsoft.Extensions.Configuration.AzureKeyVault
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;program.cs&lt;/code&gt; change:&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IHostBuilder&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CreateHostBuilder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateDefaultBuilder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConfigureWebHostDefaults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webBuilder&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;webBuilder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UseStartup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Startup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConfigureAppConfiguration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AddAzureKeyVault&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://fl-test.vault.azure.net&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                    &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;KeyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                                        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyVaultClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AuthenticationCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                                            &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AzureServiceTokenProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KeyVaultTokenCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;
                                    &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DefaultKeyVaultSecretManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;Home/index.cshtml&lt;/code&gt; add:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
   string myPassword = Configuration[&quot;supersecretpassword&quot;];
}

&amp;lt;h2&amp;gt;Retrieved from Key Vault:&amp;lt;/h2&amp;gt;
&amp;lt;h1&amp;gt;@myPassword&amp;lt;/h1&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note: Directly injecting and using config in the view like this is a &lt;strong&gt;bad&lt;/strong&gt; idea. Don’t do this in the real world please.&lt;/em&gt;&lt;/p&gt;

&lt;h1 id=&quot;do-it-on-azure&quot;&gt;Do it on Azure&lt;/h1&gt;
&lt;p&gt;This part is more about deploying to Azure and setting up Managed Identity&lt;/p&gt;

&lt;h2 id=&quot;set-up-git-on-the-repository-to-make-it-easy&quot;&gt;Set up git on the repository to make it easy&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git init 
echo &quot;bin/&quot; | out-file .gitignore -encoding utf8 
echo &quot;obj/&quot; | out-file .gitignore -encoding utf8 -append 
git add -A
git commit -m &quot;Initial commit&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;create-a-web-app-slot&quot;&gt;Create a web app slot&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Note: this won’t work in PowerShell because of the pipe symbol in “DOTNETCORE|3.0”! You need to run the &lt;code class=&quot;highlighter-rouge&quot;&gt;webapp create&lt;/code&gt; command in a command prompt or bash&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az appservice plan create --name fl-test-keyvault-secrets --sku S1 --is-linux  -o json
az webapp create --name fl-test-keyvault-secrets --plan fl-test-keyvault-secrets --runtime &quot;DOTNETCORE|3.0&quot; --deployment-local-git -o json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;enable-managed-identity-and-give-it-access-to-the-key-vault&quot;&gt;Enable Managed Identity and give it access to the key vault&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az webapp identity assign --name fl-test-keyvault-secrets

az keyvault set-policy `
    --name fl-test `
    --object-id f0e46c32-3492-407c-b31f-3e137e378ea7 `
    --secret-permissions get, list  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;add-azure-as-a-git-remote-so-we-can-push-to-it&quot;&gt;Add azure as a git remote so we can push to it&lt;/h2&gt;
&lt;p&gt;The first line gets the publishing username and password for this webapp, which you’ll be prompted for when you &lt;code class=&quot;highlighter-rouge&quot;&gt;git push&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az webapp deployment list-publishing-credentials --name fl-test-keyvault-secrets -o json
git remote add azure https://fl-test-keyvault-secrets.scm.azurewebsites.net/fl-test-keyvault-secrets.git
git push -u azure master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;check-the-result&quot;&gt;Check the result&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az webapp browse --name fl-test-keyvault-secrets
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://azureadventcalendar.com/&quot;&gt;&lt;img src=&quot;/assets/Advent-Calendar7.jpg&quot; alt=&quot;Azure Advent Calendar logo&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Azure" /><category term="Security" /><summary type="html">Use Azure Key Vault to safely store secrets and passwords in Azure</summary></entry><entry><title type="html">Secure your Web App in Azure at DDD14</title><link href="https://www.lytzen.name/2019/10/16/secure-your-webapp-in-azure-at-ddd14.html" rel="alternate" type="text/html" title="Secure your Web App in Azure at DDD14" /><published>2019-10-16T00:00:00+01:00</published><updated>2019-10-16T00:00:00+01:00</updated><id>https://www.lytzen.name/2019/10/16/secure-your-webapp-in-azure-at-ddd14</id><content type="html" xml:base="https://www.lytzen.name/2019/10/16/secure-your-webapp-in-azure-at-ddd14.html">&lt;p&gt;I had the great pleasure of giving an updated version of my &lt;a href=&quot;/talks/Securing_web_apps_in_azure.html&quot;&gt;“Secure your Web App in Azure” talk&lt;/a&gt; talk at &lt;a href=&quot;https://developerdeveloperdeveloper.com/&quot;&gt;Developer Developer Developer 14&lt;/a&gt; in Reading on 12 October 2019.&lt;/p&gt;

&lt;p&gt;A video of the whole talk is available below.&lt;/p&gt;

&lt;p&gt;I touch on a whole range of Azure technologies, but mostly I introduce and expand on a simple framework to think about and manage your exposure.&lt;/p&gt;

&lt;h2 id=&quot;example-of-exposure-and-mitigation&quot;&gt;Example of exposure and mitigation&lt;/h2&gt;
&lt;table&gt;
&lt;tr&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;External Actors&lt;/th&gt;
    &lt;th&gt;Internal Actors&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt;PREVENT&lt;/th&gt;
    &lt;td&gt;
        &lt;ul&gt;
            &lt;li&gt;
                Secure your code – see Troy Hunt’s courses as a starting point.
            &lt;/li&gt;
            &lt;li&gt;
                Lock down your servers
            &lt;/li&gt;
            &lt;li&gt;
                Use Firewalls and Intrusion Detection/Prevention Systems
            &lt;/li&gt;
            &lt;li&gt;
                Encrypt everything in transit
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;ul&gt;
            &lt;li&gt;
                Protect your passwords/secrets
            &lt;/li&gt;
            &lt;li&gt;
                Process for granting and removing access
            &lt;/li&gt;
            &lt;li&gt;
                Use Azure AD for all access, including SQL
            &lt;/li&gt;
            &lt;li&gt;
                Audit who has access on a regular basis and remove unnecessary access
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
    &lt;th&gt;DETECT&lt;/th&gt;
    &lt;td&gt;
        &lt;ul&gt;
            &lt;li&gt;
                Log and alert on any unusual application activity
                &lt;ul&gt;
                    &lt;li&gt;
                        403s and 404s
                    &lt;/li&gt;
                    &lt;li&gt;
                        Failed logins
                    &lt;/li&gt;
                    &lt;li&gt;
                        High CPU/memory, increased load
                    &lt;/li&gt;
                    &lt;li&gt;
                        Etc
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/li&gt;
            &lt;li&gt;
                Use Advanced Threat Protection
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;ul&gt;
            &lt;li&gt;
                Log and alert on all access to the backend by internal users
            &lt;/li&gt;
            &lt;li&gt;
                Log and alert on unusual access patterns by application users
            &lt;/li&gt;
            &lt;li&gt;
                Consider DLP tools
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
    &lt;th&gt;MITIGATE&lt;/th&gt;
    &lt;td colspan=&quot;2&quot;&gt;
        &lt;ul&gt;
            &lt;li&gt;
                Encrypt sensitive data at the application layer
            &lt;/li&gt;
            &lt;li&gt;
                Have ways of locking out certain users or IP addresses
            &lt;/li&gt;
            &lt;li&gt;
                For very sensitive systems, consider multi-layered architectures to contain breaches
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/td&gt;
    
&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;video-of-the-whole-talk&quot;&gt;Video of the whole talk&lt;/h2&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/HZgjlTi7OiA&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&quot;slides&quot;&gt;Slides&lt;/h2&gt;
&lt;p&gt;View the slides on Slide Share:&lt;/p&gt;
&lt;iframe src=&quot;//www.slideshare.net/slideshow/embed_code/key/DbJSjU5lVqZNUN&quot; width=&quot;595&quot; height=&quot;485&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen=&quot;&quot;&gt; &lt;/iframe&gt;
&lt;div style=&quot;margin-bottom:5px&quot;&gt; &lt;strong&gt; &lt;a href=&quot;//www.slideshare.net/FransLytzen/secure-your-azure-web-app-2019&quot; title=&quot;Secure your Azure Web App 2019&quot; target=&quot;_blank&quot;&gt;Secure your Azure Web App 2019&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href=&quot;https://www.slideshare.net/FransLytzen&quot; target=&quot;_blank&quot;&gt;Frans Lytzen&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;

&lt;p&gt;… or download from &lt;a href=&quot;https://github.com/flytzen/SecurityTalk/blob/master/Secure%20Your%20Web%20App%20Presentation.pptx?raw=true&quot;&gt;GitHub&lt;/a&gt;&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Azure" /><category term="SQL" /><category term="Security" /><category term="Web" /><summary type="html">An overview of how to secure Azure Web Apps, touching on virtual networks, encryption, key vault and monitoring.</summary></entry><entry><title type="html">Can a SHA256 Hash have a “/” in it?</title><link href="https://www.lytzen.name/2019/09/25/can-a-hash-have-a-slash.html" rel="alternate" type="text/html" title="Can a SHA256 Hash have a &quot;/&quot; in it?" /><published>2019-09-25T00:00:00+01:00</published><updated>2019-09-25T00:00:00+01:00</updated><id>https://www.lytzen.name/2019/09/25/can-a-hash-have-a-slash</id><content type="html" xml:base="https://www.lytzen.name/2019/09/25/can-a-hash-have-a-slash.html">&lt;p&gt;I was recently asked whether a SHA256 hash could have a “/” in it. If you know how hashes work, you probably know that the question doesn’t make sense. But I thought it was a good reason to write a bit about how hashes work and, specifically, how they manifest in our coding. Personally, I’ve been doing this for a long time and some of the details were rather opaque to me until recently.&lt;/p&gt;

&lt;p&gt;The short answer is that the “/” question comes about because we usually base64 encode hashes, because they are represented as byte arrays, because they are large numbers - meaning that the question really is “how do I avoid ‘/’ in base64 encoding”.&lt;/p&gt;

&lt;p&gt;Let’s peel back the layers of the onion.&lt;/p&gt;

&lt;h1 id=&quot;what-is-a-hash-and-why-do-i-want-one&quot;&gt;What is a hash and why do I want one?&lt;/h1&gt;
&lt;p&gt;The idea with a &lt;em&gt;hash&lt;/em&gt; is that you can take some input (often text, but it doesn’t have to be) and then calculate a &lt;em&gt;hash&lt;/em&gt; from it.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The hash always has the same length (the length depends on which algorithm you use).&lt;/li&gt;
  &lt;li&gt;If you hash the same input again, you will always get the same result.&lt;/li&gt;
  &lt;li&gt;It is impossible to deduce the input from the hash.&lt;/li&gt;
  &lt;li&gt;Good hashes have low &lt;a href=&quot;https://blogs.msdn.microsoft.com/ericlippert/2010/03/22/socks-birthdays-and-hash-collisions/&quot;&gt;“collision” rates&lt;/a&gt;, meaning that the output hashes are widely spread across the possible values, making it unlikely that two different inputs will produce the same output (but not impossible as the hash is shorter than the input).&lt;/li&gt;
  &lt;li&gt;A small change to the input should produce a completely different hash.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;password-hashing&quot;&gt;Password hashing&lt;/h2&gt;
&lt;p&gt;You have probably heard about hashing passwords instead of storing them. The idea here is that when the user sets up a password, you hash it and then store the hash in the database. When the user tries to log in, you take the value they enter, hash it and check if the hash matches the stored hash. If they do, it is overwhelmingly likely that they entered the correct password. But, if an attacker steals your database, they won’t be able to deduce the passwords from the hash, which is useful because people tend to re-use passwords across sites.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: This is a very short explanation and ignores such things as salting, brute force, iterations and rainbow tables. Do &lt;strong&gt;not&lt;/strong&gt; implement password hashing based on what I write here, there is a lot more to it!&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;message-authentication-codes-mac-or-hmac&quot;&gt;Message Authentication Codes (MAC or HMAC)&lt;/h2&gt;
&lt;p&gt;A very cool application of hashes is using it to make messages or other packages of data tamper proof.&lt;br /&gt;
Let’s imagine you need to put a message on a queue to process an order. The message could include a product ID and a price. What if someone could intercept that message in transit and change the price?&lt;br /&gt;
What you can do is concatenate all the information in the message and then create a &lt;em&gt;hash&lt;/em&gt; from it and include that hash in the message. The receiver can then do the same hashing and compare the resulting hash to make sure the message has not been modified in transit. This can be used in all sorts of situations, including when you round-trip data to a browser and want to make sure no-one is messing with it.
Of course, hash algorithms are public so you need to make sure the attacker can’t just re-create the hash. There are some popular approaches, depending on your situation;&lt;/p&gt;

&lt;h3 id=&quot;shared-secret&quot;&gt;Shared Secret&lt;/h3&gt;
&lt;p&gt;If you are sending data to your own system, i.e. on a message queue or round-tripping some data to a browser etc, you would usually add a &lt;em&gt;secret&lt;/em&gt; (think password) to the concatenated data before you create the hash. An attacker won’t know the secret, so can’t re-create the hash.&lt;br /&gt;
The recipient re-creates the hash in the same way you did, using the same secret, and compares the hashes to make sure they are the same.&lt;/p&gt;

&lt;h3 id=&quot;publicprivate-key-cryptography&quot;&gt;Public/Private key cryptography&lt;/h3&gt;
&lt;p&gt;If you are sending data between two parties, it is more common to use public/private key cryptography to &lt;em&gt;sign&lt;/em&gt; the message. In this case, you create a hash from the concatenated data and then you &lt;em&gt;encrypt&lt;/em&gt; the hash with your &lt;em&gt;private&lt;/em&gt; key and include the result with the message.&lt;br /&gt;
The recipient will create the hash in the same way you did. They will then &lt;em&gt;decrypt&lt;/em&gt; the hash you sent using your &lt;em&gt;public&lt;/em&gt; key and check they match.&lt;/p&gt;

&lt;h1 id=&quot;so-whats-with-that-string-and-the-&quot;&gt;So what’s with that string and the “/”?&lt;/h1&gt;
&lt;p&gt;When you generate a hash in code, you will get a &lt;em&gt;byte array&lt;/em&gt; - not a string. In order to store the hash in a database and send it over HTTP etc, you will usually base64 encode it; If you aren’t familiar with it, “base64” is a mechanism for turning binary data into strings for the purpose of transmission and storage.&lt;/p&gt;

&lt;p&gt;It turns out that, by default, base64 may produce “/” in it’s output and that can be problematic in some scenarios, such as when including it in URLs.&lt;/p&gt;

&lt;p&gt;So, can a SHA256 Hash include a “/”? No - but the base64 representation of &lt;em&gt;any&lt;/em&gt; hash might. See &lt;a href=&quot;https://en.wikipedia.org/wiki/Base64&quot;&gt;Wikipedia&lt;/a&gt; for a deeper discussion of base64 and see the “URL Applications” section for some tips on how to modify base64 to make it safe in URLs.&lt;/p&gt;

&lt;h1 id=&quot;why-is-the-hash-a-byte-array-anyway&quot;&gt;Why is the hash a byte array anyway?&lt;/h1&gt;
&lt;p&gt;When I think about a byte array I think about video files and other binary data so I struggled to understand why the hash algorithms insist on returning byte arrays. I mean, why can’t it just give me a string?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;It’s because a hash algorithm doesn’t actually produce a byte array at all.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Hash algorithms produce a very large &lt;em&gt;number&lt;/em&gt;. For example the SHA1 algorithm produces a 160-bit number; That means it takes 160 0s and 1s to write it. In base 10 it would take about 48 digits to write it out. SHA256 produces a 256 bit number, SHA512 a 512 bit number and so on.&lt;br /&gt;
Our programming languages don’t generally have built-in types that can represent numbers that large, so the 256 bits are simply chopped into 8-bit chunks and presented to you as a byte array because there is no other easy way to do it - but you should really think about it as a single number with 256 binary digits.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="C#" /><category term="Technology" /><summary type="html">I was recently asked whether a SHA256 hash could have a &quot;/&quot; in it. If you know how hashes work, you probably know that the question doesn't make sense. But I thought it was a good reason to write a bit about how hashes work and, specifically, how they manifest in our coding. Personally, I've been doing this for a long time and some of the details were rather opaque to me until recently.</summary></entry><entry><title type="html">AI will fundamentally change how we build software</title><link href="https://www.lytzen.name/2019/08/14/ai-will-fundamentally-change-software.html" rel="alternate" type="text/html" title="AI will fundamentally change how we build software" /><published>2019-08-14T00:00:00+01:00</published><updated>2019-08-14T00:00:00+01:00</updated><id>https://www.lytzen.name/2019/08/14/ai-will-fundamentally-change-software</id><content type="html" xml:base="https://www.lytzen.name/2019/08/14/ai-will-fundamentally-change-software.html">&lt;p&gt;Artificial Intelligence/Machine Learning/bots are set to fundamentally change how we design and build software - even how we think about the problems we create software to solve.&lt;/p&gt;

&lt;p&gt;I believe it’s a revolution on par with the move to web and I think many people working in the industry are yet to fully realise this. If you are a business analyst, architect, developer or even a business process specialist, your world is about to be turned upside down and you will have to learn a completely new skill-set or face becoming increasingly irrelevant.&lt;/p&gt;

&lt;p&gt;Update: I turned this article into a 10-minute lightning talk and delivered it at .Net Oxford in December 2019:&lt;/p&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/4HeRqsIf-jA&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;You are quite likely to think I am being alarmist and you may want to dismiss what I’m saying. These could be some of the things you want to tell yourself:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;A business process is a business process. &lt;br /&gt;
&lt;em&gt;No, it’s not. AI allows many business process to be completely re-defined or eliminated.&lt;/em&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;I still need to build - and know how to build - all the resilience, scale, micro services, databases and so on, all that AI stuff doesn’t remove the need for that.&lt;br /&gt;
&lt;em&gt;True - but it’s no longer enough and you may find yourself being really good at solving the wrong problem.&lt;/em&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Real people don’t want to [make some change you can’t imagine should change].&lt;br /&gt;
&lt;em&gt;Except, people do change - and more and more rapidly&lt;/em&gt;.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I like to think of this as more of an opportunity than a threat. But, it does require you to accept you are going to be a beginner again, for a while, allow yourself to learn and to challenge everything you already know. I am on this journey myself and I don’t know the answers yet - but I am enjoying exploring.&lt;/p&gt;

&lt;p&gt;Note: I am talking somewhat interchangeably about Artificial Intelligence, Machine Learning and bots. They are not the same and I am not even going to try to get the categories right, because that is not the point of this post; I am just going to talk about the impact “all of that stuff” could have on how we build software.&lt;/p&gt;

&lt;h1 id=&quot;automating-routine-tasks&quot;&gt;Automating routine tasks&lt;/h1&gt;
&lt;p&gt;The most obvious thing that springs to mind when you talk about things like Machine Learning is to automate routine tasks. The ubiquitous example is image recognition such as recognising hand writing or categorising pictures of animals into species.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://towardsdatascience.com/deep-learning-for-image-classification-why-its-challenging-where-we-ve-been-and-what-s-next-93b56948fcef&quot;&gt;&lt;img src=&quot;/assets/ClassifyPictures.png&quot; alt=&quot;Picure of photos classified into animal species&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe more relevant to people likely to read this post is things like assessing the contents of online forms to decide on actions.&lt;br /&gt;
For example, today you may have people submitting an annual health survey and have a health practitioner review these questionnaires to assess who is fine, who should receive a phone call, who should have a face-to-face visit and so on. You &lt;em&gt;can&lt;/em&gt; automate that today using hard-coded rules, but it’s probably a lot easier to analyse what the health practitioner actually decides and then train a Machine Learning model on that data.&lt;/p&gt;

&lt;p&gt;In practical teams, there are a few things you can do now to start this journey;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Understand that it’s not about getting to 100% accuracy. In most cases, Machine Learning models will spit out a &lt;strong&gt;probability&lt;/strong&gt; so you can put a rule in to say that when that probability is less than, say, 90% then this thing is referred to a human being for assessment. &lt;br /&gt;
This data can then be used to further refine the model, making it ever more accurate (you should also randomly refer some high-probability cases to a human on an ongoing basis to check and adjust the model over time).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Think about setting your software up so you can start gathering the data; without a training set, you can’t train the model in the first place. So build the system so 100% of cases go to a human for now and design it so the &lt;em&gt;decision&lt;/em&gt; is clearly recorded along with the original input. &lt;br /&gt;
That thing about recording the decision clearly is very often overlooked when you are just focused on the process and you are not thinking about the future potential for using Machine Learning.
Once you have had some data through, you can start training a model - and the UI you built stays relevant for dealing with the edge cases.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;understanding-what-is-normal&quot;&gt;Understanding what is normal&lt;/h1&gt;
&lt;p&gt;A much more subtle - and potentially pervasive - application is when a system starts to learn what’s “normal” and start to react on its own when things are “not normal”.&lt;/p&gt;

&lt;p&gt;One of the best examples at the moment is &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview&quot;&gt;Azure Application Insights&lt;/a&gt;. When you add App Insights to your system, it starts recording a lot of information, including requests, dependency calls, errors etc. You can, of course, view this in the traditional way but App Insights will also use Machine Learning to automatically build up a baseline of what’s normal and alert you when something is not normal.&lt;br /&gt;
For example, you may get an alert saying “between 10:03 and 10:07 5% of calls to [some dependency] failed - normally only 1% fail”. Or similar alerts for duration or request volume etc. The key thing here is that you do not need to set up any special rules to get these alerts, the machine learning model figures it out on its own.
&lt;img src=&quot;/assets/AppInsightsAutoDetection.png&quot; alt=&quot;Example alert from Application Insights&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Azure also has similar things for security, threat detection and logins, where they establish a baseline for “normal” and alert you to unusual things.&lt;/p&gt;

&lt;p&gt;You can use this approach in many different ways in your own software. For example, a known indicator of stress is if someone all of a sudden starts working a lot more hours. So you could use Machine Learning to automatically establish a baseline for “normal” hours &lt;em&gt;for each individual&lt;/em&gt; in your company (assuming they record timesheets) and flag it up to their manager if all of a sudden their patterns change, giving you a chance to intervene early before a wider mental health issue develops. There are standard tools out there to help you with that, including &lt;a href=&quot;https://azure.microsoft.com/en-gb/services/cognitive-services/anomaly-detector/&quot;&gt;Azure’s Anomaly Detector&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When you are designing systems, these kind of technologies need to be in your mind. Do you rely on someone manually checking for deviations or do you have alerts or hard-coded rules to detect anomalies?&lt;/p&gt;

&lt;h1 id=&quot;make-suggestions-and-correct-errors&quot;&gt;Make suggestions and correct errors&lt;/h1&gt;
&lt;p&gt;When you receive a text message on your phone or an IM on LinkedIn, you will often be given some suggested answers; These are based on Machine Learning to analyse what the message sent to you was about and what people normally respond with in similar situations.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/LinkedInIM.jpg&quot; alt=&quot;Example of LinkedIn suggesting replies&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You may have similar things in a UI where, for example, the system learns over time what kind and level of expenses a person normally records and alerts them if they enter something that is unusual for them. These are not system-wide rules, simply knowing that it’s normal for a particular individual to claim £50 for train tickets, but not £500. Or maybe that when you record mileage, more often than not it’s to a particular location so it can auto-suggest the description and distance.&lt;/p&gt;

&lt;p&gt;The list of examples get longer the more you allow yourself to think about it, starting with detecting deviations from normal to understanding what you probably meant and suggesting that. &lt;a href=&quot;https://www.autodraw.com/&quot;&gt;Google’s Autodraw experiment&lt;/a&gt; is an amazing example of this.&lt;/p&gt;

&lt;p&gt;When you are thinking about both UX and business processes - these kind of technologies need to be in your mind. Are there places where users make mistakes and we can help them not to? Are there whole new categories of problems we simply haven’t been able to solve before?
One thing’s for sure, this is becoming the new normal so you need to incorporate it in your design thinking.&lt;/p&gt;

&lt;h1 id=&quot;intent-driven-ui&quot;&gt;Intent driven UI&lt;/h1&gt;
&lt;p&gt;I think this is probably the most challenging and different area. 
It’s always been the case that good UX starts with &lt;em&gt;intent&lt;/em&gt;. You need to know what the user wants to achieve and then design the UX to make it easy to get there. With things like bots, we now often use natural language processing to derive intent from normal speech. I see many/most software interfaces for &lt;em&gt;occasional&lt;/em&gt; users needing to adopt this kind of conversational UI. But AI is not magic and making this work well is really hard.&lt;/p&gt;

&lt;p&gt;Let me use an example to illustrate what I mean.&lt;/p&gt;

&lt;p&gt;When you want to book a holiday you can probably describe it really easily to another person. Maybe “I just need to get away for a week, somewhere quiet where the kids have stuff to do. Just to get some rest and not have to think too much. It must not be too expensive, but it does need to be of a decent quality”. If you said that to an experienced travel agent, they may ask you a few follow-up questions, and would then quickly be able to suggest a few options for you. How you respond to those options (too hot, too far) would help them to better understand your needs and they would refine their suggestions. In the end, they would probably give you a list of only a handful of suggestions, even if there may be 100 trips that match your criteria because &lt;a href=&quot;https://www.amazon.com/Paradox-Choice-Barry-Schwartz/dp/0062449923/ref=cm_cr_arp_d_product_top?ie=UTF8&quot;&gt;choice is overrated&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Now imagine doing that same journey on most travel booking sites that exists today. You will be given a plethora of filters and tick-boxes so you can review every holiday option going. Except, you don’t know what half the options really mean except you know that to go somewhere quiet you need to &lt;em&gt;not&lt;/em&gt; select any of the ones that say “great night-life” or “18-30 special”. It usually ends up being an exhaustive and often frustrating journey through a bunch of options, comparing and contrasting with a lot of swearing.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/HolidayBooking.jpg&quot; alt=&quot;Example of a travel booking site&quot; /&gt;
(&lt;em&gt;I do like Crystal’s site that I stole this picture from - I think it’s one of the better ones out there, but it illustrates the point nicely. Hope they will forgive me.&lt;/em&gt;)&lt;/p&gt;

&lt;p&gt;With a more conversational UI and Machine Learning techniques, that journey could be much more like talking to an operator. Understand me right, building that system is &lt;strong&gt;hard&lt;/strong&gt;; current Artificial Intelligence is not magic and cannot “think” in any meaningful way. Underneath the covers, that nice conversation with the user still has to be translated into those same tick-boxes, so you can show them filtered results. Natural Language Processing can &lt;em&gt;help&lt;/em&gt; - but you need to identify all the intents yourself. This is not trivial but I truly believe this is where software design for occasional users is going. I believe we may see a (temporary) upsurge in slightly more hybrid solutions where artificial intelligence techniques are used but with operators being pulled in when the AI does not know what to do. However, the data gathered during those interactions will feed back into the AI model and the need for operator intervention will taper off.&lt;/p&gt;

&lt;p&gt;Is the technology and the patterns there to build the dream travel booking site I describe here yet? Probably not. But it’s coming and you should start thinking about how you can start gathering the data to train those models; what can you do today to capture information about how your users express their intent?&lt;/p&gt;

&lt;p&gt;In this example, what about the travel agent - should they talk to an AI as well? I don’t &lt;em&gt;think&lt;/em&gt; so. After all, we are trying to model the AI on an experienced travel agent and it would probably be counter-productive to have the travel agent interfacing with an inferior emulation of themselves. In other words, there is very much still a place for complicated user interfaces with lots of options for the users who use your system every day - but casual users are going to expect something different.&lt;/p&gt;

&lt;p&gt;In practice this isn’t just for complicated things like travel agent bookings; it could be as simple as a customer wanting to buy a widget from your online store. At the same time, don’t forget that sometimes a user does want to have all the information and not just a part of it, so model that intent into your considerations as well (okay, I am drifting towards general UX design here, sorry).&lt;/p&gt;

&lt;p&gt;Building conversational UIs that actually work is really hard - but it is getting easier every day and it will start to become an expectation for more and more people. Just think about how we engage with our various digital assistants. Even the humble Google Search is a lot more than just a “search”, you can ask it to translate things or do math amongst many other things.&lt;/p&gt;

&lt;p&gt;When will your customers begin to expect that they can just log in to your portal and ask a question like “when will my t-shirt arrive”, rather than having to click on their account, list their orders, click on the right one and go through to “tracking”?&lt;/p&gt;

&lt;h1 id=&quot;re-imagining-problems-fundamentally&quot;&gt;Re-imagining problems fundamentally&lt;/h1&gt;
&lt;p&gt;All the above has really been about how we change existing types of software and problems to take advantage of AI to make it better or more efficient. For most of us, that is probably the primary thing we need to worry about because that &lt;strong&gt;isn’t going away anytime soon&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;But there is also another whole class of problems that we can start to solve that simply wasn’t possible before.&lt;/p&gt;

&lt;p&gt;I recently spoke to &lt;a href=&quot;https://www.saladmoney.co.uk/&quot;&gt;Salad Money&lt;/a&gt;, a Social Enterprise that provide small, short-term loans. They use Open Banking and have fully automated their loan approval process, making it possible to provide these small, cheap loans cost-effectively and at scale. As they build up more data, they will be able to use Machine Learning to provide more tailored products to individuals, without having complicated or unfair assessment processes.&lt;/p&gt;

&lt;p&gt;This general ability to take what used to be quite complicated things that required expert involvement, automate it and deploy it at scale is something I, personally, am quite excited about and I think we will see a lot of innovation in that space.&lt;/p&gt;

&lt;h1 id=&quot;so-what-do-i-do-now&quot;&gt;So what do I do now?&lt;/h1&gt;
&lt;p&gt;I am on the journey myself, I don’t know the answers. 
I spent quite a long time over the last few years trying to get my head into how it all really works and I bought several books on the subject because that’s how I have always approached learning new technical topics. But most of the books very quickly descend into deep math and most seem intended to help you design Machine Learning algorithms - which is probably not what you want.&lt;/p&gt;

&lt;p&gt;Eventually I had a re-think and I decided on a smarter goal for my learning, at least for now:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;I want to be able to recognise where AI technologies can potentially help or change how I design software&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;That may sound obvious, but I don’t think I have internalised AI enough that I can (yet) instinctively recognise where I should think about AI. 
That is obviously the first step, because once I identify these opportunities, I can then target my learning at something much more specific and/or hire help.&lt;/p&gt;

&lt;p&gt;The best way I can achieve that is by seeing as many examples as I can. That means going to events, reading blog posts and watching videos. I do like to see how these things are put together, but that’s not the real purpose yet. I just want to load my brain up with examples so I can start to see the patterns of what is possible and start recognising the situations where I, too, should apply AI.&lt;/p&gt;

&lt;p&gt;As a secondary goal, I also want to learn enough about the practical realities that I can at least do a proof-of-concept in order to show that there could be value.&lt;br /&gt;
For example, I have identified some client scenarios that can benefit from automating classification as described above. I can use high-level tools, such as &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=MLNET.07&quot;&gt;ML.Nets Model Builder&lt;/a&gt; to do a proof-of-concept without understanding the difference between a Bayes Classifier and a Logistic Regression algorithm, knowing how to do hyperparameter tuning or even clean my data that much. Would I put the result into production? Of course not. But if I can show a model that has 80% accuracy after tinkering for a couple of hours, I can create the business case for engaging a data scientist to build the real thing. And yes, I am learning how to use &lt;a href=&quot;https://jupyter.org/&quot;&gt;Jupyter Notebooks&lt;/a&gt; and all that as well, but the truth is that I don’t actually need the grown-up tools yet.&lt;/p&gt;

&lt;p&gt;At &lt;a href=&quot;https://neworbit.co.uk&quot;&gt;NewOrbit&lt;/a&gt; we are actively embracing this journey. We are working on training programs for everyone from sales, through business analysts to developers so they can help our customers take advantage of this revolution in software design. We are also building some of our own products in order to test our skills and showcase what’s possible (and to have a bit of fun along the way).&lt;/p&gt;

&lt;p&gt;Are you learning AI? Do you think this will affect software design as much as I do? Leave a comment with your views or contact me on &lt;a href=&quot;https://twitter.com/flytzen&quot;&gt;Twitter&lt;/a&gt; - I’d love to hear what you think.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Technology" /><category term="AI" /><category term="Azure" /><summary type="html">AI will change how we think about, design and build software. It's a revolution on par with the move to web.</summary></entry><entry><title type="html">Azure Security Talk at rg-dev</title><link href="https://www.lytzen.name/2019/05/28/azure-security-at-rg-dev.html" rel="alternate" type="text/html" title="Azure Security Talk at rg-dev" /><published>2019-05-28T00:00:00+01:00</published><updated>2019-05-28T00:00:00+01:00</updated><id>https://www.lytzen.name/2019/05/28/azure-security-at-rg-dev</id><content type="html" xml:base="https://www.lytzen.name/2019/05/28/azure-security-at-rg-dev.html">&lt;p&gt;I had the pleasure of doing a presentation on &lt;a href=&quot;/talks/Securing_web_apps_in_azure&quot;&gt;Securing Web Apps in Azure&lt;/a&gt; at &lt;a href=&quot;https://www.meetup.com/rg-dev/events/253406007/&quot;&gt;rg-dev #29&lt;/a&gt; in Rzeszow, Poland on 24 May 2019. 
I was really impressed by how well organised the event was and just how dedicated and professional the audience were. We are talking about people giving up their Friday night to hear about security in Azure as well as &lt;a href=&quot;https://twitter.com/ptrstpp950&quot;&gt;Piotr Stapp&lt;/a&gt;’s talk about migrating &lt;a href=&quot;https://dotnetomaniak.pl/&quot;&gt;https://dotnetomaniak.pl/&lt;/a&gt; to Azure.&lt;br /&gt;
Apparently this was the first ever talk done in English at rg-dev, but that didn’t feel like a barrier at all.&lt;/p&gt;

&lt;p&gt;I go to Rzeszow quite frequently these days as NewOrbit has opened a small, but growing, office there (&lt;a href=&quot;https://neworbit.pl/careers/&quot;&gt;interested in joining us?&lt;/a&gt;). I look forward to attending more rg-dev meetups, though I probably need to work a bit more on my Polish :) I am consistently impressed by the developers I meet in Rzeszow and look forward to working with more of them.&lt;/p&gt;

&lt;p&gt;The slides from the talk can be downloaded in &lt;a href=&quot;https://github.com/flytzen/SecurityTalk/blob/master/Secure%20Your%20Web%20App%20Presentation.pptx?raw=true&quot;&gt;PowerPoint format from GitHub&lt;/a&gt; or you can see them (without animations) on Slideshare below:&lt;/p&gt;

&lt;div style=&quot;text-align:center;&quot;&gt;
&lt;iframe src=&quot;//www.slideshare.net/slideshow/embed_code/key/vZ12nwRamiEwrr&quot; width=&quot;595&quot; height=&quot;485&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot; allowfullscreen=&quot;&quot;&gt; &lt;/iframe&gt;
&lt;/div&gt;

&lt;p&gt;The talk covers the things you can do to secure web apps and APIs hosted in Azure Web Apps and Functions.&lt;/p&gt;

&lt;h2 id=&quot;outline&quot;&gt;Outline&lt;/h2&gt;
&lt;div style=&quot;width: 480px; height: 360px; margin: 10px; position: relative;float:right;&quot;&gt;&lt;iframe allowfullscreen=&quot;&quot; frameborder=&quot;0&quot; style=&quot;width:480px; height:360px&quot; src=&quot;https://www.lucidchart.com/documents/embeddedchart/f4062454-7eb7-4e7a-abca-2d244417011b&quot; id=&quot;Gf4kpeh9VZr3&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;
&lt;h3 id=&quot;concepts&quot;&gt;Concepts&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Understand your exposure; how much at risk are you and how much work should you do to secure your app?&lt;/li&gt;
  &lt;li&gt;Understand that you are probably more at risk from internal actors making mistakes with data than you are from external hackers.&lt;/li&gt;
  &lt;li&gt;You should think about your security at three levels;
    &lt;ul&gt;
      &lt;li&gt;How to &lt;em&gt;prevent&lt;/em&gt; someone from getting in&lt;/li&gt;
      &lt;li&gt;How to &lt;em&gt;detect&lt;/em&gt; that someone is attacking you&lt;/li&gt;
      &lt;li&gt;How to &lt;em&gt;mitigate&lt;/em&gt; the attack&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;getting-in&quot;&gt;Getting in&lt;/h3&gt;
&lt;p&gt;Azure Web Apps and Functions are already protected by a Firewall. It is impractical, if not impossible, to add your own firewall unless you use an App Service Environment. If you must, you can add a WAF and lock down the access to your web app to only the IP address of the WAF.&lt;br /&gt;
SSL Certificates in Azure are harder than they should be, the talk covers a few different options and their pros and cons.&lt;/p&gt;

&lt;p&gt;I strongly encourage you to use Azure ADB2C (and/or Azure AD) for authentication instead of having your own usernames and passwords.&lt;/p&gt;

&lt;h3 id=&quot;secret-management&quot;&gt;Secret Management&lt;/h3&gt;
&lt;p&gt;One of the biggest problem with both security and auditing is that the application needs passwords to access certain services; Those passwords need to be stored somewhere, which usually means they are exposed to various people. This leads to auditing and security issues.&lt;/p&gt;

&lt;p&gt;With Azure Key Vault and Managed Identity it is surprisingly easy to eliminate this problem; there is a lot to learn before you can do it - but the actual implementation is really easy.&lt;/p&gt;

&lt;h3 id=&quot;network-isolation&quot;&gt;Network Isolation&lt;/h3&gt;
&lt;p&gt;By default, all your back-end services such as Cosmos, SQL, storage and so on are open to other services running in Azure and some are open to the Internet. It is surprisingly easy to set up a private Virtual Network and set your back-end services so they can only be accessed from that virtual network - and then allow your web app to talk to that network. You can even set up micro-services hosted in Azure Web Apps or Functions in this way, completely blocking access from anything other than your web app.&lt;/p&gt;

&lt;p&gt;The main challenge with the virtual networks is that 90% of the documentation on them has to do with features that are irrelevant when you are using Web Apps instead of VMs or Cloud Services, so it’s mainly about knowing what to ignore.&lt;/p&gt;

&lt;h3 id=&quot;encryption&quot;&gt;Encryption&lt;/h3&gt;
&lt;p&gt;Once the attacker is in - or the well-meaning employee is accessing data they probably shouldn’t - it is extremely helpful that the data is encrypted. The obvious at-rest and transport encryption is there by default, but you can use Always Encrypted and Client-side encryption to easily encrypt data at the application level.&lt;/p&gt;

&lt;h3 id=&quot;detection&quot;&gt;Detection&lt;/h3&gt;
&lt;p&gt;One of the most overlooked areas of security is detecting when someone is attacking you. If you don’t know someone is trying to hack you or that some well-meaning employee is accessing data they shouldn’t, you can’t do anything about it.
Azure has a rich set of features to help alert you when something isn’t right. In the talk I focus on Application Insights, Threat Protection and Advanced Data Security.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Azure" /><summary type="html">I did a talk on &quot;How to secure your web-app in Azure&quot; at rg-dev</summary></entry><entry><title type="html">Find SELECT N+1 with Application Insights</title><link href="https://www.lytzen.name/2019/05/20/find-select-nplus1-with-app-insights.html" rel="alternate" type="text/html" title="Find SELECT N+1 with Application Insights" /><published>2019-05-20T00:00:00+01:00</published><updated>2019-05-20T00:00:00+01:00</updated><id>https://www.lytzen.name/2019/05/20/find-select-nplus1-with-app-insights</id><content type="html" xml:base="https://www.lytzen.name/2019/05/20/find-select-nplus1-with-app-insights.html">&lt;p&gt;ORMs like Entity Framework are good for many things - but they also make it easy to write “SELECT N+1 queries”. This is when you thought you just did one SQL call but you make one call to retrieve the list of records and then (at least) one more call for each row in the resultset, because you loop over the data and inadvertently auto-expand a property. You rarely spot it in development and even in production it is sometimes hard to see; It may well be that a particular operation causes your code to call SQL 500 times, but that may take less than a second so the operation may not even show up at the top of your “performance offenders” list. But, it’s still a lot of traffic to send to SQL and, combined with the fact that SELECT N+1 problems are usually very easy to fix, it’s worthwhile hunting them down and sorting them out.&lt;/p&gt;

&lt;p&gt;By default Application Insights log every Request made to your web/api server and log every &lt;em&gt;dependency call&lt;/em&gt;, such as database and micro service call you do. It connects the two together by giving the dependency call a &lt;code class=&quot;highlighter-rouge&quot;&gt;operation_ParentId&lt;/code&gt; that is the same as the &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt; of the request.
In short, you can join the &lt;code class=&quot;highlighter-rouge&quot;&gt;requests&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies&lt;/code&gt; to list each web/api request and show how many SQL calls it generated and how long they took to run in aggregate like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;requests 
| project name, id, duration
| join kind = leftouter (
   dependencies 
   | where type  == 'SQL'
   | project sqlid = id, operation_ParentId , sqlduration = duration 
) on $left.id == $right.operation_ParentId 
| summarize sqlopscount = countif(isnotempty(sqlid)), sqlopsduration = sum(sqlduration) by name, id, duration
| order by sqlopscount  desc 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that this query will show each individual request made. You may want to roll that up further to see the &lt;em&gt;type&lt;/em&gt; of call - but I find that quite often it is helpful to know the exact call to make it easier to reproduce it.&lt;br /&gt;
I am currently working through a legacy app that has a lot of these kind of problems; I look at the result of this query and then set to work fixing them. It’s a very easy way to find major causes of stress on the database.&lt;/p&gt;

&lt;h3 id=&quot;cosmosdb&quot;&gt;CosmosDb&lt;/h3&gt;
&lt;p&gt;You can use the same query, just change &lt;code class=&quot;highlighter-rouge&quot;&gt;type&lt;/code&gt; to “Azure DocumentDB”.&lt;/p&gt;

&lt;h3 id=&quot;what-about-other-dependencies---or-if-my-sql-calls-are-not-logged&quot;&gt;What about other dependencies - or if my SQL calls are not logged?&lt;/h3&gt;
&lt;p&gt;When running ASP.Net (Core or otherwise) on Azure Web Apps, your SQL calls are automatically logged as dependencies. In other scenarios, this may not happen automatically. You may need to install certain extensions to pick them up - or you may have to write your own. Incidentally, writing your own can also be very helpful if you want to do the same statistics for something other than SQL.&lt;br /&gt;
In short, you can write code to wrap dependency operations in calls to &lt;code class=&quot;highlighter-rouge&quot;&gt;TelemetryClient.StartOperation&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;TelemetryClient.StopOperation&lt;/code&gt; - see the &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/azure-monitor/app/custom-operations-tracking&quot;&gt;Telemetry Client documentation&lt;/a&gt;.&lt;/p&gt;</content><author><name>Frans Lytzen</name></author><category term="Azure" /><summary type="html">With ORMs it's very easy to write code that calls SQL many times to serve a single web requests, and it can be hard to find it. Application Insights can help.</summary></entry></feed>