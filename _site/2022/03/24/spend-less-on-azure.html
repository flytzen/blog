<!DOCTYPE html> <html lang="en"> <head> <title>Frans' Randomness - Spend less on Azure</title> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="format-detection" content="telephone=no" /> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" href="/assets/main.css?v=20180627"> <link type="application/atom+xml" rel="alternate" href="https://www.lytzen.name/feed.xml" title="Frans' Randomness" /> <meta name="description" content="It is estimated that 30% of cloud spend is wasted. How do you avoid wasting 30% of your Azure spend? This talk takes you through the approach NewOrbit takes to analyse and optimise Azure costs." /> </head> <body> <header class="header" role="banner"> <div class="wrapper"> <a class="header__title h3" rel="author" href="/">Frans&#39; Randomness</a> <nav class="header__nav"> <a class="header__nav-link" href="/talks">Talks</a> <a class="header__nav-link" href="/blog">Blog</a> </nav> </div> </header> <main class="page-content" aria-label="Content"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post__header"> <div class="wrapper"> <h1 class="post__title" itemprop="name headline">Spend less on Azure</h1> <div class="post__meta"> <div class="post__author-time"> <span class="post__author" itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Author <strong>Frans Lytzen</strong></span> </span> <time class="post__date-time dt-published" datetime="2022-03-24T00:00:00+00:00" itemprop="datePublished"> <div class="date-time icon__item"> <svg class="icon__gfx" style="width:24px;height:24px" viewBox="0 0 24 24"> <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1" /> </svg> <span class="icon__txt">24 Mar 2022</span> </div> </time> </div> <div class="tags icon__item"> <svg class="icon__gfx" style="width:24px;height:24px" viewBox="0 0 24 24"> <path d="M5.5,9A1.5,1.5 0 0,0 7,7.5A1.5,1.5 0 0,0 5.5,6A1.5,1.5 0 0,0 4,7.5A1.5,1.5 0 0,0 5.5,9M17.41,11.58C17.77,11.94 18,12.44 18,13C18,13.55 17.78,14.05 17.41,14.41L12.41,19.41C12.05,19.77 11.55,20 11,20C10.45,20 9.95,19.78 9.58,19.41L2.59,12.42C2.22,12.05 2,11.55 2,11V6C2,4.89 2.89,4 4,4H9C9.55,4 10.05,4.22 10.41,4.58L17.41,11.58M13.54,5.71L14.54,4.71L21.41,11.58C21.78,11.94 22,12.45 22,13C22,13.55 21.78,14.05 21.42,14.41L16.04,19.79L15.04,18.79L20.75,13L13.54,5.71Z" /> </svg> <a href="/tags/#Azure" class="icon__txt tag">Azure</a> </div> </div> </div> </header> <div class="wrapper"> <div class="post__content e-content" itemprop="articleBody"> <p>One of the things our clients often ask us to do is to review their Azure spend to see if they can save costs. It is common for us to identify potential cost savings of between 30% and 70%.</p> <p>I gave a talk at <a href="https://www.dotnetoxford.com/posts/2022-03-OptimiseYourAzureSpends">.Net Oxford</a> in March 2022 that goes through the methodology we use when doing <a href="https://neworbit.co.uk/azure/#need-help">cost reviews</a>.</p> <h1 id="video">Video</h1> <iframe width="560" height="315" src="https://www.youtube.com/embed/s0v-2lf3URs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <h1 id="talk-summary">Talk Summary</h1> <h2 id="where-is-the-money-going">Where is the money going</h2> <p>The built-in Azure Cost Analysis tool is a really good way to understand where your actual spend is. But, it does require some getting used to.<br /> We follow a 3-step approach.</p> <p>For each step:</p> <ul> <li>Change the time period to the previous month.</li> <li>Change the Granularity to None</li> <li>Change the display to Column (Grouped)</li> </ul> <h3 id="1-understand-the-big-picture">1. Understand the big picture</h3> <p>Change “Group By” to “Service Family” to get an idea about the split between Compute, Database and so on. Then change it to “Service Type” to get a slightly more detailed view of the split.</p> <p>The main thing here is to understand where most of your money is spent. There is little point in trying to reduce a £50 to a £40 spend, if you have another spend that is £5,000, which you can reduce to £4,000. Focus your energy on the areas that are most expensive.</p> <h3 id="2-which-resource-is-it">2. Which resource is it?</h3> <p>Once you have identified which service types are most expensive, it’s time to find out which instance it is.</p> <p>For that purpose, first add a filter for that particular service type and then Group By “Resource”. “Resource” means “Resource Name”, and will allow you to identify the specific instances that are most expensive.</p> <h3 id="3-what-part-of-the-service-is-it-that-is-costing">3. What part of the service is it that is costing?</h3> <p>Most services in Azure have costs that are made up of multiple sub-parts, such as bandwidth, storage, etc. It is important to understand exactly which bit it is that is expensive - you will often be surprised, so don’t make assumptions.</p> <p>First, add a filter for the specific resource you are looking at. Then try grouping by Meter, Meter Category and Meter Subcategory. There seems to be little consistency that I can see to what hides under each of these, so try them all in turn. This often leads to surprises about what it <em>actually</em> is that is so expensive.</p> <h2 id="checklist">Checklist</h2> <p>For each resource you want to reduce the cost for, this is the general checklist we go through (see the video for much more detail):</p> <ol> <li>Is the service the right size? Have you over-provisioned? Are you using too high a service tier or redundancy level?</li> <li>Is this the best service for what you are doing? Azure has many different services for each type of thing you want - and they often differ wildly in price. You can often save substantial sums by simply changing from one service type to another.</li> <li>Do you use the correct scale? Could you use scheduled, automatic or manual scaling to reduce costs?</li> <li>Could you share resources? There are many services in Azure where multiple service instances can share one set of compute and thus costs.</li> <li>Are you using Infrastructure-as-a-Service rather than Platform-as-a-Service? IaaS is <em>usually</em> more expensive, not least because you usually need two instances to get the SLA, whereas with <em>most</em> PaaS you only need one instance.</li> <li>Do you have services that are not actually in use? Demo or test systems that are kept running even when not used? Or services that were spun up and since abandoned?</li> <li>Could you benefit from Reserved Instances to get a discount from Azure?</li> <li>Are you in the right location? Some services are more expensive in some data centres.</li> </ol> <h2 id="architecture">Architecture</h2> <p>We recommend four general principles for an architecture that reduces cost by design. The first two are the same that we recommend to achieve <a href="/2022/02/20/designing-for-scale-in-the-cloud.html">scale and resilience in the cloud</a>, so you get two benefits for the price of one.</p> <ol> <li>Use Queues. Without queues, you have to always provision enough capacity to deal with the highest potential spike in traffic. Queues give you a buffer so you can run with much lower provisioned capacity; spikes in traffic are soaked up in the queues.</li> <li>Use appropriate databases and storage options. Azure has many different ways to store data, including a wide variety of databases and things like Storage, Search and more. Moving some types of data to another storage type can sometimes reduce cost by 99% (yes, really).</li> <li>Scale <em>out</em> rather than <em>up</em>. Azure inherently prefers many small workloads rather than a few large workloads and will make it easier for you if you follow that paradigm. It gives you much more granularity in terms of scaling and may also give you absolute cost savings.</li> <li>Avoid Virtual Machines as far as possible. Use PaaS or containers instead.</li> </ol> <h2 id="chattiness">Chattiness</h2> <p>One of the most common problems we find when doing cost reviews is that the system is too chatty. Usually, this means that the application makes way too many calls to the database backend, though sometimes it is the web front-end that makes too many calls to the API server. In either case, this causes excessive load on both front and backend, which means higher costs. Most developers are surprised when we show them this - you may be surprised too.</p> <p>See our <a href="/2019/05/20/find-select-nplus1-with-app-insights.html">post on how to detect this</a> to get a simple Application Insights query you can run to check it. You might be able to save quite a bit on your database by tidying up a bit of code or introducing a tiny bit of memory cache.</p> <h1 id="conclusion">Conclusion</h1> <p><a href="https://www.neworbit.co.uk/azure">NewOrbit</a> is an Azure Gold Partner and Azure Reseller (“Direct CSP”) as well as development house. If you would like to buy your Azure from people who design and develop systems on Azure every day, give us a <a href="https://neworbit.co.uk/#contact">shout</a> or ping me on <a href="https://twitter.com/flytzen">Twitter</a>. We usually give you a “trial”, in the form of a Cost, Infrastructure or Security review so you can see if we can help you and if you like working with us.</p> </div> <div id="disqus_thread"></div> <script> var disqus_config = function () { this.page.url = 'https://www.lytzen.name/2022/03/24/spend-less-on-azure.html'; this.page.identifier = '/2022/03/24/spend-less-on-azure.html'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://flytzen.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <a class="u-url" href="/2022/03/24/spend-less-on-azure.html" hidden></a> </div> </article> </main> <footer class="footer"> <div class="wrapper"> <div class="social-links"> <a href="https://github.com/flytzen" target="_blank" alt="GitHub"> <svg style="width:24px;height:24px" viewBox="0 0 24 24" class="social-icon"> <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" /> </svg> </a> <a href="https://www.linkedin.com/in/flytzen/" target="_blank" alt="LinkedIn"> <svg style="width:24px;height:24px" viewBox="0 0 24 24" class="social-icon"> <path d="M21,21H17V14.25C17,13.19 15.81,12.31 14.75,12.31C13.69,12.31 13,13.19 13,14.25V21H9V9H13V11C13.66,9.93 15.36,9.24 16.5,9.24C19,9.24 21,11.28 21,13.75V21M7,21H3V9H7V21M5,3A2,2 0 0,1 7,5A2,2 0 0,1 5,7A2,2 0 0,1 3,5A2,2 0 0,1 5,3Z" /> </svg> </a> <a href="https://twitter.com/flytzen" target="_blank"> <svg style="width:24px;height:24px" viewBox="0 0 24 24" class="social-icon" alt="Twitter"> <path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" /> </svg> </a> <a rel="me" href="https://hachyderm.io/@flytzen" target="_blank"> <svg style="width:24px;height:24px" fill="currentColor" viewBox="0 0 24 24" class="social-icon" alt="Mastodon"> <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/> </svg> </a> </div> <div class="copyright"> &copy; Frans Lytzen 2022 </div> </div> </footer> </body> </html>
