---
layout: post
title: Find docs with no PartitionKey in Azure DocumentDb
date: '2016-12-06T21:31:00.000Z'
author: Frans Lytzen
tags:
- DocumentDB
- azure
modified_time: '2017-02-07T08:53:24.393Z'
blogger_id: tag:blogger.com,1999:blog-8302357413081836531.post-1012054093326151693
blogger_orig_url: http://blog.lytzen.name/2016/12/find-docs-with-no-partitionkey-in-azure.html
---

When you are using Partitioned Collections in Azure DocumentDb you need to specify a <i>Partition Key</i> on each Document. At least, I thought you did. But, it turns out that you actually <i>can</i>&nbsp;save documents without a partitionkey. But if you do, you'll have a hard time retrieving or deleting them - until you meet Undefined.Value.<br /><i>Note: This post is written for C#, I am not sure about the equivalent for other languages.</i><br /><i><br /></i><br /><h4>Details</h4><div>If you create a Partitioned Collection in Azure DocumentDb you probably think that every document you save must have a partitionkey property and probably also that it must have a value. In this post I am dealing with the situation where you don't have a partition key property on your document at all, not the situation where you have one but you set it to null or an empty string.<br /><br /></div><div>For example, if you have created your collection with code similar to this;<br /><pre class="prettyprint">var docCollection = new DocumentCollection()<br />{<br />   Id = this.collectionName<br />};<br />docCollection.PartitionKey.Paths.Add("/partitionKey");<br />await docClient.CreateDocumentCollectionAsync(<br />                    UriFactory.CreateDatabaseUri(this.dbName), <br />                    docCollection);</pre>and you then try to save an instance of a class that looks like this:<br /><pre class="prettyprint">public class MyItem<br />{<br />    [JsonProperty("id")]<br />    public string Id { get; set; }<br /><br />    public string SomeValue { get; set; }<br />}<br /></pre>then you may expect to get an error. But, in fact, it will save just fine as I found out to my detriment after a major refactoring.</div><br /><div>Now that you have that item in the database you will find it hard to retrieve it and even harder to delete it - until you meet your new friend <b>Undefined.Value</b>.<br /><br /></div><div><h3>How to read the document:</h3><pre class="prettyprint">MyItem item = (dynamic)client.ReadDocumentAsync(<br />                           UriFactory.CreateDocumentUri(DbName, CollectionName, id),<br />                           new RequestOptions() {<br />                             PartitionKey = new PartitionKey(Undefined.Value)<br />                           })<br />                         .Result.Resource;<br /></pre></div><div><h3>How to delete the document:</h3><pre class="prettyprint">client.DeleteDocumentAsync(<br />          UriFactory.CreateDocumentUri(DbName, CollectionName, id), <br />          new RequestOptions() { PartitionKey = new PartitionKey(Undefined.Value) });<br /></pre></div>Many thanks to <a href="https://twitter.com/arkramac">Aravind Ramachandran</a> for telling me about Undefined.Value.<br /><br /><br /><br /><br /><br />